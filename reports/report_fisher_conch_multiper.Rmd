---
output:
  officedown::rdocx_document:
    reference_docx: report_template.docx
    tables:
      style: table_template
params:
  release: "Unknown"
  user_name: "Unknown"
  fisher_multiper_timeframe: "Annual"
  datafile1: pressure
  datafile1_name: "Unknown"
  datafile2: pressure
  datafile2_name: "Unknown"
  datafile3: NULL
  datafile3_name: "Unknown"
  datafile4: NULL
  datafile4_name: "Unknown"
  fisher_multiper1_year_selection: "None"
  fisher_multiper1_period_selection: "None"
  fisher_multiper1_lobster_season_selection: "None" 
  fisher_multiper1_conch_season_selection: "None" 
  fisher_multiper1_finfish_season_selection: "None"
  fisher_multiper2_year_selection: "None"
  fisher_multiper2_period_selection: "None"
  fisher_multiper2_lobster_season_selection: "None" 
  fisher_multiper2_conch_season_selection: "None" 
  fisher_multiper2_finfish_season_selection: "None"
  fisher_multiper3_year_selection: "None"
  fisher_multiper3_period_selection: "None"
  fisher_multiper3_lobster_season_selection: "None" 
  fisher_multiper3_conch_season_selection: "None" 
  fisher_multiper3_finfish_season_selection: "None"
  fisher_multiper4_year_selection: "None"
  fisher_multiper4_period_selection: "None"
  fisher_multiper4_lobster_season_selection: "None" 
  fisher_multiper4_conch_season_selection: "None" 
  fisher_multiper4_finfish_season_selection: "None"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

# Load packages ---------------------------
library(knitr)
library(officedown)
library(rmarkdown)
library(tidyverse)
library(ggpubr)

# Source code  ---------------------------
source("theme.r")
source("map.r")

# Define datafiles ---------------------------
datafile_names <- c(params$datafile1_name, params$datafile2_name)
if (!is.null(params$datafile3)) {
  datafile_names <- c(datafile_names, params$datafile3_name)
}
if (!is.null(params$datafile4)) {
  datafile_names <- c(datafile_names, params$datafile4_name)
}
datafiles <- knitr::combine_words(datafile_names)

# Determine year or season  ---------------------------
timeframe <- params$fisher_multiper_timeframe

# Filter to year or season  ---------------------------
df_1 <- params$datafile1[[1]]
df_1$`Waypoint Date` <- as.Date(df_1$`Waypoint Date`)
if (timeframe == "Annual" && as.character(params$fisher_multiper1_year_selection) != "None") {
  df_1 <- df_1 |>
    filter(format(`Waypoint Date`, "%Y") == params$fisher_multiper1_year_selection)
} else if (timeframe == "Seasonal" && as.character(params$fisher_multiper1_conch_season_selection) != "None") {
  season_years <- unlist(strsplit(params$fisher_multiper1_conch_season_selection, "-"))
  start_date <- as.Date(paste0(season_years[1], "-07-01"))
  end_date <- as.Date(paste0(season_years[2], "-02-28"))
  df_1 <- df_1 |>
    filter(`Waypoint Date` >= start_date, `Waypoint Date` <= end_date)
}
df_2 <- params$datafile2[[1]]
df_2$`Waypoint Date` <- as.Date(df_2$`Waypoint Date`)
if (timeframe == "Annual" && as.character(params$fisher_multiper2_year_selection) != "None") {
  df_2 <- df_2 |>
    filter(format(`Waypoint Date`, "%Y") == params$fisher_multiper2_year_selection)
} else if (timeframe == "Seasonal" && as.character(params$fisher_multiper2_conch_season_selection) != "None") {
  season_years <- unlist(strsplit(params$fisher_multiper2_conch_season_selection, "-"))
  start_date <- as.Date(paste0(season_years[1], "-07-01"))
  end_date <- as.Date(paste0(season_years[2], "-02-28"))
  df_2 <- df_2 |>
    filter(`Waypoint Date` >= start_date, `Waypoint Date` <= end_date)
}
if (!is.null(params$datafile3)) {
  df_3 <- params$datafile3[[1]]
  df_3$`Waypoint Date` <- as.Date(df_3$`Waypoint Date`)
  if (timeframe == "Annual" && as.character(params$fisher_multiper3_year_selection) != "None") {
    df_3 <- df_3 |>
      filter(format(`Waypoint Date`, "%Y") == params$fisher_multiper3_year_selection)
  } else if (timeframe == "Seasonal" && as.character(params$fisher_multiper3_conch_season_selection) != "None") {
    season_years <- unlist(strsplit(params$fisher_multiper3_conch_season_selection, "-"))
    start_date <- as.Date(paste0(season_years[1], "-07-01"))
    end_date <- as.Date(paste0(season_years[2], "-02-28"))
    df_3 <- df_3 |>
      filter(`Waypoint Date` >= start_date, `Waypoint Date` <= end_date)
  }
}
if (!is.null(params$datafile4)) {
  df_4 <- params$datafile4[[1]]
  df_4$`Waypoint Date` <- as.Date(df_4$`Waypoint Date`)
  if (timeframe == "Annual" && as.character(params$fisher_multiper4_year_selection) != "None") {
    df_4 <- df_4 |>
      filter(format(`Waypoint Date`, "%Y") == params$fisher_multiper4_year_selection)
  } else if (timeframe == "Seasonal" && as.character(params$fisher_multiper4_conch_season_selection) != "None") {
    season_years <- unlist(strsplit(params$fisher_multiper4_conch_season_selection, "-"))
    start_date <- as.Date(paste0(season_years[1], "-07-01"))
    end_date <- as.Date(paste0(season_years[2], "-02-28"))
    df_4 <- df_4 |>
      filter(`Waypoint Date` >= start_date, `Waypoint Date` <= end_date)
  }
}

# Add month column  ---------------------------
df_1$Month <- format(df_1$`Waypoint Date`, "%b %Y")
df_2$Month <- format(df_2$`Waypoint Date`, "%b %Y")
if (!is.null(params$datafile3)) {
  df_3$Month <- format(df_3$`Waypoint Date`, "%b %Y")
}
if (!is.null(params$datafile4)) {
  df_4$Month <- format(df_4$`Waypoint Date`, "%b %Y")
}

# Define individual study timeframes ---------------------------
study_start_1 <- min(df_1$`Waypoint Date`, na.rm = TRUE)
study_end_1 <- max(df_1$`Waypoint Date`, na.rm = TRUE)
study_start_2 <- min(df_2$`Waypoint Date`, na.rm = TRUE)
study_end_2 <- max(df_2$`Waypoint Date`, na.rm = TRUE)
if (!is.null(params$datafile3)) {
  study_start_3 <- min(df_3$`Waypoint Date`, na.rm = TRUE)
  study_end_3 <- max(df_3$`Waypoint Date`, na.rm = TRUE)
}
if (!is.null(params$datafile4)) {
  study_start_4 <- min(df_4$`Waypoint Date`, na.rm = TRUE)
  study_end_4 <- max(df_4$`Waypoint Date`, na.rm = TRUE)
}

# Assign Season if Relevant ---------------------------
if (timeframe == "Seasonal") {
  df_1 <- mutate(df_1, Season = paste0(format(study_start_1, "%Y"), "-", format(study_end_1, "%Y")))
  df_2 <- mutate(df_2, Season = paste0(format(study_start_2, "%Y"), "-", format(study_end_2, "%Y")))
  if (!is.null(params$datafile3)) {
    df_3 <- mutate(df_3, Season = paste0(format(study_start_3, "%Y"), "-", format(study_end_3, "%Y")))
  }
  if (!is.null(params$datafile4)) {
    df_4 <- mutate(df_4, Season = paste0(format(study_start_4, "%Y"), "-", format(study_end_4, "%Y")))
  }
}

# Merge dfs  ---------------------------
df <- df_1 %>%
  bind_rows(df_2)
if (!is.null(params$datafile3)) {
  df <- df %>%
    bind_rows(df_3)
}
if (!is.null(params$datafile4)) {
  df <- df %>%
    bind_rows(df_4)
}

# Define study timeframe ---------------------------
study_start <- min(df$`Waypoint Date`, na.rm = TRUE)
study_end <- max(df$`Waypoint Date`, na.rm = TRUE)
if (timeframe == "Annual") {
  study_timeframe <- combine_words(unique(format(df$`Waypoint Date`, "%Y")))
} else if (timeframe == "Seasonal") {
  study_timeframe <- c(paste0(format(study_start_1, "%Y"), "-", format(study_end_1, "%Y")), paste0(format(study_start_2, "%Y"), "-", format(study_end_2, "%Y")))
  if (!is.null(params$datafile3)) {
    study_timeframe <- c(study_timeframe, paste0(format(study_start_3, "%Y"), "-", format(study_end_3, "%Y")))
  }
  if (!is.null(params$datafile4)) {
    study_timeframe <- c(study_timeframe, paste0(format(study_start_4, "%Y"), "-", format(study_end_4, "%Y")))
  }
  study_timeframe <- combine_words(study_timeframe)
}
```

# Turneffe Atoll Fisher Catch Conch `r timeframe` Dataset Report: `r study_timeframe`


Turneffe Atoll Sustainability Association (TASA)


***


The marine resources and biodiversity abundant in coral reef ecosystems support the 
livelihoods of coastal communities, and provide economic opportunities that can be 
sustainable given attentive management and enforcement. 
Monitoring the activities and harvests of local fishers is important for 
understanding ecosystem productivity, assessing stock sustainability, 
and informing effective management decisions. 
This report presents `r tolower(timeframe)` findings from fishery-dependent monitoring of queen conch (_Aliger gigas_) 
at Turneffe Atoll Marine Reserve (TAMR) from `r study_timeframe`. 
Data were recorded directly by fishermen using SMART technology through a data collection 
package designed by TASA. This report aims to summarize and visualize the Fisher 
Conch Catch dataset from `r study_timeframe` to facilitate data interpretation and support 
management decisions by TASA staff, collaborators, and stakeholders.\


## Background

### Turneffe Atoll Marine Reserve

Turneffe Atoll is the largest atoll in Belize, spanning mangrove and littoral forest cayes, seagrass beds, and coral reef ecosystems (Stoddart, 1962). 
It features an inner lagoon as well as an outer reef that encircles the atoll. 
The Turneffe Atoll Marine Reserve (TAMR), which encompasses the entire atoll, covers 1,471 km² and includes multiple management zones, such as general use, conservation, preservation, and spawning aggregation zones, as well as special management areas. 
TAMR plays a valuable role in supporting biodiversity and sustaining the communities that depend on its resources. 
Its reef provides coastal protection from extreme weather events (Fedler, 2011), serves as a habitat for diverse marine species, and supports economic activities such as commercial and recreational fishing, guided diving, and tourism.\

### Fisher Catch Project

The Fisher Catch Data Program is a pilot initiative led by the Turneffe Atoll Sustainability 
Association (TASA) and funded by the Inter-American Development Bank (IDB). The 
program aims to evaluate the effectiveness of using digital technology for catch 
reporting by fishers in the General Use Zone of the Turneffe Atoll Marine Reserve 
(TAMR), specifically for Queen Conch, Caribbean Spiny Lobster, and finfish. By 
transitioning from paper-based data sheets to a customized, simplified version of the 
SMART Fisheries Catch Data module, the program streamlines data collection and 
submission. Fishers were equipped with a complete kit—including a SMART-enabled 
device, measuring tools, and training materials—and participated in a three-day training 
session on standardized data collection and entry. This fishery-dependent monitoring 
effort gathers key biological and spatial data such as species composition, size, gear 
type, fishing effort, and location. The information collected will help assess fishing 
pressure, track Catch per Unit Effort (CPUE), ultimately guiding adaptive fisheries 
management strategies.

The primary objective of the Fisher Catch Program at the Turneffe Atoll Marine Reserve 
(TAMR) is to assess whether fishers can effectively use digital technology to report catch 
data on Queen Conch, Caribbean Spiny Lobster, and finfish. By replacing traditional 
paper-based methods, the program aims to simplify and standardize data collection and 
submission, while generating accurate, fishery-dependent data to inform adaptive 
fisheries management, track trends in fishing pressure and landings.\

### Queen Conch

Queen conch (_Aliger gigas_) are large-sized Caribbean gastropods characterized by their distinctive whorl-shaped shell with a set of thick spines at the apex. 
Juvenile queen conch have a pink, pearly interior, and the shell has a recognizable dark periostracum layer. 
Sex is determined by the presence of either a verge or egg groove inside the shell, which can only be observed by removing the conch from its shell. 
Reproduction occurs during warmer months (Appeldoorn and Baker 2013). 

In Belize, the queen conch fishery is the second most important commercial fishery in the country. 
Conch are harvested by free diving depths of 5-60ft in seagrass beds and coral reef habitats. 
The fishery is regulated by the Belize Fisheries Department (BFD). 
National regulations mandate that conch may only be harvested if they exceed a shell length of 7 inches, and only during the open season, which extends from October 1st until June 30th of the following year, or until the national conch quota is reached, whichever occurs first. 
The use of SCUBA for commercial conch harvesting is strictly prohibited. 
Additionally, commercial fishing activities in Belize require a fishing license (Belize Fisheries Department accessed 2025).

According to NOAA, queen conch density needs to be at least 100 conch per hectare to facilitate proper mating (NOAA Fisheries 2025).\


## Methods

Fisher catch data were collected at Turneffe Atoll 
Marine Reserve (TAMR) (Figure 1). 
The survey period for this report’s dataset extended 
from `r study_start` to `r study_end` at TAMR.

The fishermen participating in the Fisher Catch Program at TAMR were selected based 
on their active use of the General Use Zone within the Turneffe Atoll Marine Reserve 
and their willingness to participate in a pilot program focused on digital data collection. 
TASA prioritized individuals who represented the main fishing groups in the 
area—sailboat fishers, skiff fishers, and camp fishers—to ensure broad coverage of 
fishing practices and effort across different habitats. Selection also considered the 
fishers’ availability for training and their interest in adopting technology to support 
sustainable fisheries management.

Data on conch weight (oz) (primarily market clean weight) were entered by fishermen using SMART 
technology through a data collection package 
designed by TASA. 
The process of entering data by fishermen into SMART in the Fisher Catch Program follows a 
structured and simplified workflow designed for ease of use in the field:

1. **Catch and Effort Recording**: After each fishing trip, the fisher records details of the 
   catch, including species (Queen Conch, Caribbean Spiny Lobster, or finfish), quantity, 
   size (measured using calipers, scales, or fishboards), gear type used, hours fished, and 
   fishing location. 

2. **Use of SMART Device**: The fisher uses the provided SMART-enabled device (typically a 
   smartphone) to input the recorded data directly into the customized, user-friendly 
   SMART Fisheries Catch Data module. 

3. **Guided Input**: The module includes drop-down menus, visual aids, and pre-set data 
   fields to guide fishers through the entry process, reducing errors and ensuring 
   consistency. 

4. **Spatial Data Entry**: Spatial information (coordinates) are automatically recorded 
   showing where fishing took place. 

5. **Review and Save**: Before finalizing, fishers can review their entries for accuracy. Once 
   confirmed, the data is saved locally on the device. 

6. **Data Sync**: When the device connects to the internet (either at sea if possible or upon 
   return to shore), the data is synced with the central SMART database managed by TASA 
   for validation, analysis, and reporting.


This report, including text, figures, and tables, was generated using the 
Turneffe Reef-Monitoring Data Reporting Tool (TASA 2025, version `r params$release`), an R Shiny app which takes 
standardized reef monitoring data, validates the dataset, and creates a shareable output. \


```{r figure1, echo = FALSE, fig.width = 7, fig.height = 7}
# Create map for Figure 1 ---------------------------
df_map <- df |>
  select(`Waypoint ID`, Y, X) |>
  distinct()
if (length(unique(df$`Waypoint ID`)) < 5) {
  generate_map(df_map, "Y", "X", "Waypoint ID")
} else {
  generate_map_nolabels(df_map, "Y", "X", "Waypoint ID")
}
```


*Figure 1.* Map of Turneffe Atoll Marine Reserve zones and ecosystems. 
Shapefiles for zones belong to the Belize Fisheries Department (Belize Geomatics 2022). 
Shapefiles for the base map and ecosystems come from the publicly available Spatial Data 
Warehouse for Belize (Meerman 2013, Meerman 2017).
Waypoints for conch recorded in `r study_timeframe` are labelled on the map.\

 
## Results


```{r table1_prep, echo = FALSE, include = FALSE}
# Create df for Table 1 ---------------------------
if (timeframe == "Annual") {
  df_events_overall <- df %>%
    select(`Waypoint ID`, `Hours Fished`, `Total Lbs of Catch`) %>%
    distinct() %>%
    filter(!is.na(`Hours Fished`), !is.na(`Total Lbs of Catch`), `Hours Fished` > 0) %>%
    summarize(
      Hours = sum(`Hours Fished`, na.rm = TRUE),
      `Catch (lb)` = sum(`Total Lbs of Catch`, na.rm = TRUE)
    ) %>%
    mutate(Year = "Overall")
  df_table1_overall <- df %>%
    summarize(
      Fishers = n_distinct(`Fishers Name`),
      Conch = n(),
      Events = n_distinct(`Waypoint ID`)
    ) %>%
    mutate(Year = "Overall") %>%
    left_join(df_events_overall, by = "Year") %>%
    mutate(
      `CPUE (lb/hr)` = ifelse(Hours > 0, round(`Catch (lb)` / Hours, 1), NA),
      `CPUE (num/hr)` = ifelse(Hours > 0, round(Conch / Hours, 1), NA)
    )
  df_events <- df %>%
    mutate(
      Year = format(df$`Waypoint Date`, "%Y")
    ) %>%
    select(Year, `Waypoint ID`, `Hours Fished`, `Total Lbs of Catch`) %>%
    distinct() %>%
    filter(!is.na(`Hours Fished`), !is.na(`Total Lbs of Catch`), `Hours Fished` > 0) %>%
    group_by(Year) %>%
    summarize(
      Hours = sum(`Hours Fished`, na.rm = TRUE),
      `Catch (lb)` = sum(`Total Lbs of Catch`, na.rm = TRUE)
    )
  df_table1 <- df %>%
    mutate(
      Year = format(df$`Waypoint Date`, "%Y")
    ) %>%
    group_by(Year) %>%
    summarize(
      Fishers = n_distinct(`Fishers Name`),
      Conch = n(),
      Events = n_distinct(`Waypoint ID`)
    ) %>%
    left_join(df_events, by = "Year") %>%
    mutate(
      `CPUE (lb/hr)` = ifelse(Hours > 0, round(`Catch (lb)` / Hours, 1), NA),
      `CPUE (num/hr)` = ifelse(Hours > 0, round(Conch / Hours, 1), NA)
    ) %>%
    bind_rows(df_table1_overall)
}
if (timeframe == "Seasonal") {
  df_events_overall <- df %>%
    select(`Waypoint ID`, `Hours Fished`, `Total Lbs of Catch`) %>%
    distinct() %>%
    filter(!is.na(`Hours Fished`), !is.na(`Total Lbs of Catch`), `Hours Fished` > 0) %>%
    summarize(
      Hours = sum(`Hours Fished`, na.rm = TRUE),
      `Catch (lb)` = sum(`Total Lbs of Catch`, na.rm = TRUE)
    ) %>%
    mutate(Season = "Overall")
  df_table1_overall <- df %>%
    summarize(
      Fishers = n_distinct(`Fishers Name`),
      Conch = n(),
      Events = n_distinct(`Waypoint ID`)
    ) %>%
    mutate(Season = "Overall") %>%
    left_join(df_events_overall, by = "Season") %>%
    mutate(
      `CPUE (lb/hr)` = ifelse(Hours > 0, round(`Catch (lb)` / Hours, 1), NA),
      `CPUE (num/hr)` = ifelse(Hours > 0, round(Conch / Hours, 1), NA)
    )
  df_events <- df %>%
    select(Season, `Waypoint ID`, `Hours Fished`, `Total Lbs of Catch`) %>%
    distinct() %>%
    filter(!is.na(`Hours Fished`), !is.na(`Total Lbs of Catch`), `Hours Fished` > 0) %>%
    group_by(Season) %>%
    summarize(
      Hours = sum(`Hours Fished`, na.rm = TRUE),
      `Catch (lb)` = sum(`Total Lbs of Catch`, na.rm = TRUE)
    )
  df_table1 <- df %>%
    group_by(Season) %>%
    summarize(
      Fishers = n_distinct(`Fishers Name`),
      Conch = n(),
      Events = n_distinct(`Waypoint ID`)
    ) %>%
    left_join(df_events, by = "Season") %>%
    mutate(
      `CPUE (lb/hr)` = ifelse(Hours > 0, round(`Catch (lb)` / Hours, 1), NA),
      `CPUE (num/hr)` = ifelse(Hours > 0, round(Conch / Hours, 1), NA)
    ) %>%
    bind_rows(df_table1_overall)
}

# Prepare dynamic variables for Table 1 ---------------------------
if (timeframe == "Annual") {
  total_fishers <- length(unique(df$`Fishers Name`))
  total_conch <- df_table1_overall$Conch
  total_events <- df_table1_overall$Events
  total_hours <- df_table1_overall$Hours
  max_cpue_lb <- max(df_table1$`CPUE (lb/hr)`, na.rm = TRUE)
  max_cpue_lb_year <- df_table1$Year[which.max(df_table1$`CPUE (lb/hr)`)]
  min_cpue_lb <- min(df_table1$`CPUE (lb/hr)`, na.rm = TRUE)
  min_cpue_lb_year <- df_table1$Year[which.min(df_table1$`CPUE (lb/hr)`)]
  max_cpue_num <- max(df_table1$`CPUE (num/hr)`, na.rm = TRUE)
  max_cpue_num_year <- df_table1$Year[which.max(df_table1$`CPUE (num/hr)`)]
  min_cpue_num <- min(df_table1$`CPUE (num/hr)`, na.rm = TRUE)
  min_cpue_num_year <- df_table1$Year[which.min(df_table1$`CPUE (num/hr)`)]
}
if (timeframe == "Seasonal") {
  total_fishers <- length(unique(df$`Fishers Name`))
  total_conch <- df_table1_overall$Conch
  total_events <- df_table1_overall$Events
  total_hours <- df_table1_overall$Hours
  max_cpue_lb <- max(df_table1$`CPUE (lb/hr)`, na.rm = TRUE)
  max_cpue_lb_year <- df_table1$Season[which.max(df_table1$`CPUE (lb/hr)`)]
  min_cpue_lb <- min(df_table1$`CPUE (lb/hr)`, na.rm = TRUE)
  min_cpue_lb_year <- df_table1$Season[which.min(df_table1$`CPUE (lb/hr)`)]
  max_cpue_num <- max(df_table1$`CPUE (num/hr)`, na.rm = TRUE)
  max_cpue_num_year <- df_table1$Season[which.max(df_table1$`CPUE (num/hr)`)]
  min_cpue_num <- min(df_table1$`CPUE (num/hr)`, na.rm = TRUE)
  min_cpue_num_year <- df_table1$Season[which.min(df_table1$`CPUE (num/hr)`)]
}
```


Between `r study_start` and `r study_end`, `r total_fishers` fishermen contributed data to the queen conch SMART dataset. 
A total of `r total_conch` conch were caught across `r total_events` 
fishing events, totalling `r total_hours` active fishing hours. 
The highest catch per unit effort (CPUE) 
in pounds per hour (lb/hr) occurred in `r max_cpue_lb_year` with `r max_cpue_lb`, whereas the lowest 
occurred in `r min_cpue_lb_year` with `r min_cpue_lb`. The highest CPUE in count 
per hour (num/hr) occurred in `r max_cpue_num_year` 
with `r max_cpue_num`, whereas the lowest was `r min_cpue_num_year` 
in `r min_cpue_num` (Table 1; Figure 2).\


**Table 1.** Summary of fishing activity by period, including total fishers, events, and conch caught, 
along with fishing hours, pounds of catch, and catch per unit effort (CPUE). 
CPUE values are calculated only for events where fishing hours and catch weight were recorded. 
Data were collected using SMART conch data from fishers at Turneffe Atoll Marine Reserve, `r study_timeframe`.\

```{r table1, echo = FALSE}
# show table
as.data.frame(df_table1)
```


<br>


```{r table2_prep, echo = FALSE, include = FALSE}
# Create annual df for Table 2 ---------------------------
if (timeframe == "Annual") {
  df_table2_rows <- df %>%
    mutate(
      Year = format(df$`Waypoint Date`, "%Y")
    ) %>%
    group_by(`Waypoint ID`) %>%
    summarize(
      Year = first(Year),
      Hours = first(`Hours Fished`),
      Catch_lb = first(`Total Lbs of Catch`),
      Conch = n(),
      .groups = "drop"
    ) %>%
    mutate(
      `CPUE (lb/hr)` = ifelse(Hours > 0, Catch_lb / Hours, NA),
      `CPUE (num/hr)` = ifelse(Hours > 0, Conch / Hours, NA)
    )
  df_table2_lb_overall <- df_table2_rows %>%
    summarize(
      Min = round(min(`CPUE (lb/hr)`, na.rm = TRUE), 1),
      Mean = round(mean(`CPUE (lb/hr)`, na.rm = TRUE), 1),
      Median = round(median(`CPUE (lb/hr)`, na.rm = TRUE), 1),
      Max = round(max(`CPUE (lb/hr)`, na.rm = TRUE), 1),
      SD = round(sd(`CPUE (lb/hr)`, na.rm = TRUE), 1)
    ) %>%
    mutate(Year = "Overall", CPUE = "lb/hr")
  df_table2_lb <- df_table2_rows %>%
    mutate(CPUE = "lb/hr") %>%
    group_by(CPUE, Year) %>%
    summarize(
      Min = round(min(`CPUE (lb/hr)`, na.rm = TRUE), 1),
      Mean = round(mean(`CPUE (lb/hr)`, na.rm = TRUE), 1),
      Median = round(median(`CPUE (lb/hr)`, na.rm = TRUE), 1),
      Max = round(max(`CPUE (lb/hr)`, na.rm = TRUE), 1),
      SD = round(sd(`CPUE (lb/hr)`, na.rm = TRUE), 1),
      .groups = "drop"
    ) %>%
    bind_rows(df_table2_lb_overall)
  df_table2_num_overall <- df_table2_rows %>%
    summarize(
      Min = round(min(`CPUE (num/hr)`, na.rm = TRUE), 1),
      Mean = round(mean(`CPUE (num/hr)`, na.rm = TRUE), 1),
      Median = round(median(`CPUE (num/hr)`, na.rm = TRUE), 1),
      Max = round(max(`CPUE (num/hr)`, na.rm = TRUE), 1),
      SD = round(sd(`CPUE (num/hr)`, na.rm = TRUE), 1)
    ) %>%
    mutate(Year = "Overall", CPUE = "num/hr")
  df_table2_num <- df_table2_rows %>%
    mutate(CPUE = "num/hr") %>%
    group_by(CPUE, Year) %>%
    summarize(
      Min = round(min(`CPUE (num/hr)`, na.rm = TRUE), 1),
      Mean = round(mean(`CPUE (num/hr)`, na.rm = TRUE), 1),
      Median = round(median(`CPUE (num/hr)`, na.rm = TRUE), 1),
      Max = round(max(`CPUE (num/hr)`, na.rm = TRUE), 1),
      SD = round(sd(`CPUE (num/hr)`, na.rm = TRUE), 1),
      .groups = "drop"
    ) %>%
    bind_rows(df_table2_num_overall)
  df_table2 <- df_table2_lb_overall %>%
    bind_rows(df_table2_num_overall) %>%
    select(CPUE, Min, Mean, Median, Max, SD)

  # Prepare dynamic variables for Table 2 ---------------------------
  overall_mean <- df_table2_lb_overall$Mean
  overall_median <- df_table2_lb_overall$Median
  max_cpue_mean_lb <- max(df_table2_lb$Mean, na.rm = TRUE)
  max_cpue_mean_lb_year <- df_table2_lb$Year[which.max(df_table2_lb$Mean)]
  min_cpue_mean_lb <- min(df_table2_lb$Mean, na.rm = TRUE)
  min_cpue_mean_lb_year <- df_table2_lb$Year[which.min(df_table2_lb$Mean)]
  max_cpue_mean_num <- max(df_table2_num$Mean, na.rm = TRUE)
  max_cpue_mean_num_year <- df_table2_num$Year[which.max(df_table2_num$Mean)]
  min_cpue_mean_num <- min(df_table2_num$Mean, na.rm = TRUE)
  min_cpue_mean_num_year <- df_table2_num$Year[which.min(df_table2_num$Mean)]
}

# Create seasonal df for Table 2 ---------------------------
if (timeframe == "Seasonal") {
  df_table2_rows <- df %>%
    group_by(`Waypoint ID`) %>%
    summarize(
      Season = first(Season),
      Hours = first(`Hours Fished`),
      Catch_lb = first(`Total Lbs of Catch`),
      Conch = n(),
      .groups = "drop"
    ) %>%
    mutate(
      `CPUE (lb/hr)` = ifelse(Hours > 0, Catch_lb / Hours, NA),
      `CPUE (num/hr)` = ifelse(Hours > 0, Conch / Hours, NA)
    )
  df_table2_lb_overall <- df_table2_rows %>%
    summarize(
      Min = round(min(`CPUE (lb/hr)`, na.rm = TRUE), 1),
      Mean = round(mean(`CPUE (lb/hr)`, na.rm = TRUE), 1),
      Median = round(median(`CPUE (lb/hr)`, na.rm = TRUE), 1),
      Max = round(max(`CPUE (lb/hr)`, na.rm = TRUE), 1),
      SD = round(sd(`CPUE (lb/hr)`, na.rm = TRUE), 1)
    ) %>%
    mutate(Season = "Overall", CPUE = "lb/hr")
  df_table2_lb <- df_table2_rows %>%
    mutate(CPUE = "lb/hr") %>%
    group_by(CPUE, Season) %>%
    summarize(
      Min = round(min(`CPUE (lb/hr)`, na.rm = TRUE), 1),
      Mean = round(mean(`CPUE (lb/hr)`, na.rm = TRUE), 1),
      Median = round(median(`CPUE (lb/hr)`, na.rm = TRUE), 1),
      Max = round(max(`CPUE (lb/hr)`, na.rm = TRUE), 1),
      SD = round(sd(`CPUE (lb/hr)`, na.rm = TRUE), 1),
      .groups = "drop"
    ) %>%
    bind_rows(df_table2_lb_overall)
  df_table2_num_overall <- df_table2_rows %>%
    summarize(
      Min = round(min(`CPUE (num/hr)`, na.rm = TRUE), 1),
      Mean = round(mean(`CPUE (num/hr)`, na.rm = TRUE), 1),
      Median = round(median(`CPUE (num/hr)`, na.rm = TRUE), 1),
      Max = round(max(`CPUE (num/hr)`, na.rm = TRUE), 1),
      SD = round(sd(`CPUE (num/hr)`, na.rm = TRUE), 1)
    ) %>%
    mutate(Season = "Overall", CPUE = "num/hr")
  df_table2_num <- df_table2_rows %>%
    mutate(CPUE = "num/hr") %>%
    group_by(CPUE, Season) %>%
    summarize(
      Min = round(min(`CPUE (num/hr)`, na.rm = TRUE), 1),
      Mean = round(mean(`CPUE (num/hr)`, na.rm = TRUE), 1),
      Median = round(median(`CPUE (num/hr)`, na.rm = TRUE), 1),
      Max = round(max(`CPUE (num/hr)`, na.rm = TRUE), 1),
      SD = round(sd(`CPUE (num/hr)`, na.rm = TRUE), 1),
      .groups = "drop"
    ) %>%
    bind_rows(df_table2_num_overall)
  df_table2 <- df_table2_lb_overall %>%
    bind_rows(df_table2_num_overall) %>%
    select(CPUE, Min, Mean, Median, Max, SD)

  # Prepare dynamic variables for Table 2 ---------------------------
  overall_mean <- df_table2_lb_overall$Mean
  overall_median <- df_table2_lb_overall$Median
  max_cpue_mean_lb <- max(df_table2_lb$Mean, na.rm = TRUE)
  max_cpue_mean_lb_year <- df_table2_lb$Season[which.max(df_table2_lb$Mean)]
  min_cpue_mean_lb <- min(df_table2_lb$Mean, na.rm = TRUE)
  min_cpue_mean_lb_year <- df_table2_lb$Season[which.min(df_table2_lb$Mean)]
  max_cpue_mean_num <- max(df_table2_num$Mean, na.rm = TRUE)
  max_cpue_mean_num_year <- df_table2_num$Season[which.max(df_table2_num$Mean)]
  min_cpue_mean_num <- min(df_table2_num$Mean, na.rm = TRUE)
  min_cpue_mean_num_year <- df_table2_num$Season[which.min(df_table2_num$Mean)]
}
```


The CPUE of conch in pounds per hour had a 
mean of `r overall_mean`lb/hr and median of `r overall_median`lb/hr, 
with the highest mean of `r max_cpue_mean_lb`lb/hr being in `r max_cpue_mean_lb_year` 
and the lowest mean of `r min_cpue_mean_lb`lb/hr being in `r min_cpue_mean_lb_year`. 
The CPUE of conch in count per hour had a 
mean of `r overall_mean`num/hr and median of `r overall_median`num/hr, 
with the highest mean of `r max_cpue_mean_lb`num/hr being in `r max_cpue_mean_lb_year` 
and the lowest mean of `r min_cpue_mean_lb`num/hr being in `r min_cpue_mean_lb_year`. 
(Table 2; Figure 2).\


```{r figure2_prep, echo = FALSE, include = FALSE}
# Create annual dfs for Figure 2 ---------------------------
if (timeframe == "Annual") {
  df_fig2_A <- df %>%
    mutate(
      Year = format(df$`Waypoint Date`, "%Y")
    ) %>%
    group_by(Year) %>%
    summarize(
      Fishers = n_distinct(`Fishers Name`),
      Conch = n(),
      Events = n_distinct(`Waypoint ID`)
    ) %>%
    left_join(df_events, by = "Year") %>%
    mutate(
      `CPUE (lb/hr)` = round(`Catch (lb)` / Hours, 1),
      `CPUE (num/hr)` = round(Conch / Hours, 1)
    )

  # Create panels for Figure 2 ---------------------------
  A <- ggplot(df_fig2_A, aes(x = Year, y = Events, group = 1)) +
    geom_line(size = 0.5) +
    geom_point(size = 2.5) +
    expand_limits(y = 0) +
    theme_custom +
    ylab("Fishing Events") +
    labs(title = "A")
  B <- ggplot(df_fig2_A, aes(x = Year, y = Hours, group = 1)) +
    geom_line(size = 0.5) +
    geom_point(size = 2.5) +
    expand_limits(y = 0) +
    theme_custom +
    ylab("Hours Fished") +
    labs(title = "B")
  C <- ggplot(df_fig2_A, aes(x = Year, y = Conch, group = 1)) +
    geom_line(size = 0.5) +
    geom_point(size = 2.5) +
    expand_limits(y = 0) +
    theme_custom +
    ylab("Number Conchs") +
    labs(title = "C")
  D <- ggplot(df_fig2_A, aes(x = Year, y = `Catch (lb)`, group = 1)) +
    geom_line(size = 0.5) +
    geom_point(size = 2.5) +
    expand_limits(y = 0) +
    theme_custom +
    ylab("Catch (lb)") +
    labs(title = "D")
  E <- ggplot(df_fig2_A, aes(x = Year, group = 1)) +
    geom_line(aes(y = `CPUE (lb/hr)`), size = 0.5) +
    geom_point(aes(y = `CPUE (lb/hr)`, shape = "lb/hr"), size = 2.5) +
    geom_line(aes(y = `CPUE (num/hr)`), size = 0.5) +
    geom_point(aes(y = `CPUE (num/hr)`, shape = "num/hr"), size = 2.5) +
    expand_limits(y = 0) +
    scale_shape_manual(
      name = "CPUE Type",
      values = c("lb/hr" = 4, "num/hr" = 19)
    ) +
    theme_custom +
    ylab("Catch per Unit Effort") +
    labs(title = "E")
}

# Create seasonal dfs for Figure 2 ---------------------------
if (timeframe == "Seasonal") {
  df_fig2_A <- df %>%
    group_by(Season) %>%
    summarize(
      Fishers = n_distinct(`Fishers Name`),
      Conch = n(),
      Events = n_distinct(`Waypoint ID`)
    ) %>%
    left_join(df_events, by = "Season") %>%
    mutate(
      `CPUE (lb/hr)` = round(`Catch (lb)` / Hours, 1),
      `CPUE (num/hr)` = round(Conch / Hours, 1)
    )

  # Create panels for Figure 2 ---------------------------
  A <- ggplot(df_fig2_A, aes(x = Season, y = Events, group = 1)) +
    geom_line(size = 0.5) +
    geom_point(size = 2.5) +
    expand_limits(y = 0) +
    theme_custom +
    ylab("Fishing Events") +
    labs(title = "A")
  B <- ggplot(df_fig2_A, aes(x = Season, y = Hours, group = 1)) +
    geom_line(size = 0.5) +
    geom_point(size = 2.5) +
    expand_limits(y = 0) +
    theme_custom +
    ylab("Hours Fished") +
    labs(title = "B")
  C <- ggplot(df_fig2_A, aes(x = Season, y = Conch, group = 1)) +
    geom_line(size = 0.5) +
    geom_point(size = 2.5) +
    expand_limits(y = 0) +
    theme_custom +
    ylab("Number Conchs") +
    labs(title = "C")
  D <- ggplot(df_fig2_A, aes(x = Season, y = `Catch (lb)`, group = 1)) +
    geom_line(size = 0.5) +
    geom_point(size = 2.5) +
    expand_limits(y = 0) +
    theme_custom +
    ylab("Catch (lb)") +
    labs(title = "D")
  E <- ggplot(df_fig2_A, aes(x = Season, group = 1)) +
    geom_line(aes(y = `CPUE (lb/hr)`), size = 0.5) +
    geom_point(aes(y = `CPUE (lb/hr)`, shape = "lb/hr"), size = 2.5) +
    geom_line(aes(y = `CPUE (num/hr)`), size = 0.5) +
    geom_point(aes(y = `CPUE (num/hr)`, shape = "num/hr"), size = 2.5) +
    expand_limits(y = 0) +
    scale_shape_manual(
      name = "CPUE Type",
      values = c("lb/hr" = 4, "num/hr" = 19)
    ) +
    theme_custom +
    ylab("Catch per Unit Effort") +
    labs(title = "E")
}

# Assemble Figure 2 ---------------------------
figure_2_top <- ggarrange(
  A, B, C, D,
  ncol = 2, nrow = 2
)
figure2 <- ggarrange(
  figure_2_top, E,
  ncol = 1,
  heights = c(2, 1)
)
```


```{r figure2, fig.width=6, fig.height=8, fig.align = 'left', echo = FALSE}
figure2
```


*Figure 2.* Line plots of fishing events (A), 
active hours fished (B), conch caught (C), 
and catch per unit effort (in pounds and count per hour) (D) 
over time, collected using SMART conch data from fishers at Turneffe 
Atoll Marine Reserve, `r study_timeframe`.\


**Table 2.** Summary statistics for catch per unit effort in lb/hr and count/hr, 
including minimum, mean, median, and maximum values, 
along with standard deviation. 
CPUE values are calculated only for events where fishing hours and catch weight were recorded. 
Data were collected using SMART conch data from fishers at Turneffe Atoll Marine Reserve, `r study_timeframe`.\

```{r table2, echo = FALSE}
# show table
as.data.frame(df_table2)
```


<br>


```{r table3_prep, echo = FALSE, include = FALSE}
# Create annual df for Table 3 ---------------------------
if (timeframe == "Annual") {
  df_table3 <- df %>%
    mutate(
      Year = format(df$`Waypoint Date`, "%Y")
    ) %>%
    filter(`Weight Type` == "Market Clean") %>%
    group_by(Year) %>%
    summarize(
      `Mean Weight (oz)` = round(mean(`Weight (oz)`, na.rm = TRUE), 1),
      `Median Weight (oz)` = round(median(`Weight (oz)`, na.rm = TRUE), 1),
    ) %>%
    bind_rows(
      df %>%
        summarize(
          `Mean Weight (oz)` = round(mean(`Weight (oz)`, na.rm = TRUE), 1),
          `Median Weight (oz)` = round(median(`Weight (oz)`, na.rm = TRUE), 1)
        ) %>%
        mutate(Year = "Overall")
    ) %>%
    mutate(across(everything(), ~ {
      if (is.numeric(.)) {
        ifelse(is.na(.) | is.nan(.), "-", as.character(.))
      } else {
        ifelse(is.na(.), "-", .)
      }
    }))

  # Prepare dynamic variables for Table 3 ---------------------------
  total_weight <- filter(df_table3, Year == "Overall")$`Mean Weight (oz)`
  max_weight <- max(filter(df_table3, Year != "Overall")$`Mean Weight (oz)`, na.rm = TRUE)
  max_weight_year <- df_table3$Year[which.max(filter(df_table3, Year != "Overall")$`Mean Weight (oz)`)]
}

# Create seasonal df for Table 3 ---------------------------
if (timeframe == "Seasonal") {
  df_table3 <- df %>%
    filter(`Weight Type` == "Market Clean") %>%
    group_by(Season) %>%
    summarize(
      `Mean Weight (oz)` = round(mean(`Weight (oz)`, na.rm = TRUE), 1),
      `Median Weight (oz)` = round(median(`Weight (oz)`, na.rm = TRUE), 1),
    ) %>%
    bind_rows(
      df %>%
        summarize(
          `Mean Weight (oz)` = round(mean(`Weight (oz)`, na.rm = TRUE), 1),
          `Median Weight (oz)` = round(median(`Weight (oz)`, na.rm = TRUE), 1)
        ) %>%
        mutate(Season = "Overall")
    ) %>%
    mutate(across(everything(), ~ {
      if (is.numeric(.)) {
        ifelse(is.na(.) | is.nan(.), "-", as.character(.))
      } else {
        ifelse(is.na(.), "-", .)
      }
    }))

  # Prepare dynamic variables for Table 3 ---------------------------
  total_weight <- filter(df_table3, Season == "Overall")$`Mean Weight (oz)`
  max_weight <- max(filter(df_table3, Season != "Overall")$`Mean Weight (oz)`, na.rm = TRUE)
  max_weight_year <- df_table3$Season[which.max(filter(df_table3, Season != "Overall")$`Mean Weight (oz)`)]
}
```

Average market clean weight was `r total_weight`oz, greatest in `r max_weight_year` with `r max_weight`oz (Table 3; Figure 3).\


**Table 3.** Summary of mean and median market clean weight (oz),  
using SMART conch data from fishers at Turneffe Atoll Marine Reserve, `r study_timeframe`.

```{r table3, echo = FALSE}
# show table
as.data.frame(df_table3)
```


```{r figure3_prep, echo = FALSE, include = FALSE}
# Create annual dfs for Figure 3 ---------------------------
if (timeframe == "Annual") {
  df_fig3_unsummarized <- df %>%
    mutate(
      Year = format(df$`Waypoint Date`, "%Y")
    ) %>%
    filter(`Weight Type` == "Market Clean")
  df_fig3 <- df %>%
    mutate(
      Year = format(df$`Waypoint Date`, "%Y")
    ) %>%
    filter(`Weight Type` == "Market Clean") %>%
    group_by(Year) %>%
    summarize(
      `Mean Weight (oz)` = round(mean(`Weight (oz)`, na.rm = TRUE), 1),
      `Median Weight (oz)` = round(median(`Weight (oz)`, na.rm = TRUE), 1)
    )
  df_fig3_weight <- df_fig3 %>%
    filter(!is.nan(`Mean Weight (oz)`))

  # Create panels for Figure 3 ---------------------------
  A <- ggplot(df_fig3_unsummarized, aes(x = `Weight (oz)`)) +
    geom_histogram(binwidth = 1, color = "black") +
    theme_custom +
    expand_limits(x = 0) +
    xlab("Weight (oz)") +
    ylab("Count") +
    labs(title = "A") +
    theme(legend.position = "none")
  B <- ggplot(df_fig3_weight, aes(x = Year, y = `Mean Weight (oz)`)) +
    geom_line(size = 0.5) +
    geom_point(size = 2.5) +
    theme_custom +
    ylab("Weight (oz)") +
    labs(title = "B") +
    theme(legend.position = "none")
}

# Create seasonal dfs for Figure 3 ---------------------------
if (timeframe == "Seasonal") {
  df_fig3_unsummarized <- df %>%
    filter(`Weight Type` == "Market Clean")
  df_fig3 <- df %>%
    filter(`Weight Type` == "Market Clean") %>%
    group_by(Season) %>%
    summarize(
      `Mean Weight (oz)` = round(mean(`Weight (oz)`, na.rm = TRUE), 1),
      `Median Weight (oz)` = round(median(`Weight (oz)`, na.rm = TRUE), 1)
    )
  df_fig3_weight <- df_fig3 %>%
    filter(!is.nan(`Mean Weight (oz)`))

  # Create panels for Figure 3 ---------------------------
  A <- ggplot(df_fig3_unsummarized, aes(x = `Weight (oz)`)) +
    geom_histogram(binwidth = 1, color = "black") +
    theme_custom +
    expand_limits(x = 0) +
    xlab("Weight (oz)") +
    ylab("Count") +
    labs(title = "A") +
    theme(legend.position = "none")
  B <- ggplot(df_fig3_weight, aes(x = Season, y = `Mean Weight (oz)`)) +
    geom_line(size = 0.5) +
    geom_point(size = 2.5) +
    theme_custom +
    ylab("Weight (oz)") +
    labs(title = "B") +
    theme(legend.position = "none")
}

# Assemble Figure 3 ---------------------------
figure3 <- ggarrange(
  A, B,
  ncol = 1, nrow = 2
)
```


```{r figure3, fig.width=6, fig.height=5, fig.align = 'left', echo = FALSE}
figure3
```


*Figure 3.* Histogram of market clean weight (oz) (A), 
and line plot of mean weight (oz) over time (B), 
collected using SMART conch data from fishers at Turneffe 
Atoll Marine Reserve, `r study_timeframe`.\


<br>


## Conclusion

By summarizing and visualizing the fisher catch conch SMART data from `r study_timeframe`, 
researchers, policy-makers, and other stakeholders are better able to interpret and use the dataset. 
This report supports the aims of the Fisher Catch SMART data collection by offering a more understandable view 
of the data itself, supporting future efforts to create recommendations on enforcement, monitoring, 
education, outreach, and regulations to ensure the long-term sustainability of the TAMR fishery while safeguarding the 
ecological value of the atoll.\


## Acknowledgments

Thank you to the fishers who contributed to this project.\


## Report Metadata

**Date Generated:** `r format(Sys.time(), '%Y-%m-%d')` \
**Source Data:** `r datafile_names` \
**Generated by:** `r params$user_name`\
**App Version:** `r params$release`\


## Literature Cited

Appeldoorn, R. S., & Baker, N. (2013). A Literature Review of the Queen Conch, Strombus gigas [Technical Report]. University of Puerto Rico.

Belize Fisheries Department. (n.d.). Capture Fisheries Unit. https://fisheries.gov.bz/units/cfu/

Fedler, A. J. (2011). The Economic Value of Turneffe Atoll (Full Report). Turneffe Atoll Trust. http://www.turneffeatollmarinereserve.org/app/webroot/userfiles/214/File/Turneffe%20Atoll%20Valuation%20Study%20PDF%20-%20Final%20Report.pdf

Meerman, J. C. (2013). Belize Basemap [Dataset]. Biodiversity and Environmental Resource Data System of Belize. http://www.biodiversity.bz/

Meerman, J. C. (2017). Belize_Ecosystems_2017 [Dataset]. Biodiversity and Environmental Resource Data System of Belize. http://www.biodiversity.bz/

NOAA Fisheries. (2025). Queen Conch: Science. https://www.fisheries.noaa.gov/species/queen-conch/science

Stoddart, D. R. (1962). Three Caribbean atolls: Turneffe Islands, Lighthouse Reef and Glover’s Reef,  British Honduras. Atoll Research Bulletin, 87, 1–151.

Turneffe Atoll Sustainability Association. (2025). Turneffe Reef-Monitoring Data Reporting Tool (Version 1.0) [Computer software].
