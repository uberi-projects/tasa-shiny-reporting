---
output:
  officedown::rdocx_document:
    reference_docx: report_template.docx
    tables:
      style: table_template
params:
  release: "Unknown"
  user_name: "Unknown"
  datafile: pressure
  datafile_name: "Unknown"
  fisheries_1per_timeframe: "Annual"
  fisheries_1per_year_selection: "None"
  fisheries_1per_period_selection: "None"
  fisheries_1per_lobster_season_selection: "None" 
  fisheries_1per_conch_season_selection: "None" 
  fisheries_1per_finfish_season_selection: "None"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

# Load packages ---------------------------
library(knitr)
library(officedown)
library(rmarkdown)
library(tidyverse)
library(ggpubr)

# Source code  ---------------------------
source("theme.r")
source("map.r")

# Determine year or season  ---------------------------
timeframe <- params$fisheries_1per_timeframe

# Filter to year or season  ---------------------------
df <- params$datafile[[1]]
df$`Date of Encounter` <- as.Date(df$`Date of Encounter`)
if (timeframe == "Annual" && as.character(params$fisheries_1per_year_selection) != "None") {
  df <- df |>
    filter(format(`Date of Encounter`, "%Y") == params$fisheries_1per_year_selection)
} else if (timeframe == "Seasonal" && as.character(params$fisheries_1per_conch_season_selection) != "None") {
  season_years <- unlist(strsplit(params$fisheries_1per_conch_season_selection, "-"))
  start_date <- as.Date(paste0(season_years[1], "-07-01"))
  end_date <- as.Date(paste0(season_years[2], "-02-28"))
  df <- df |>
    filter(`Date of Encounter` >= start_date, `Date of Encounter` <= end_date)
}

# Add month column  ---------------------------
df$Month <- format(df$`Date of Encounter`, "%b %Y")

# Define study timeframe ---------------------------
study_start <- min(df$`Date of Encounter`, na.rm = TRUE)
study_end <- max(df$`Date of Encounter`, na.rm = TRUE)
if (timeframe == "Annual") {
  study_timeframe <- unique(format(df$`Date of Encounter`, "%Y"))[1]
} else if (timeframe == "Seasonal") {
  study_timeframe <- paste0(format(study_start, "%Y"), "-", format(study_end, "%Y"))
}
```

# Turneffe Atoll Fisheries Catch Conch `r timeframe` Dataset Report: `r study_timeframe`


Turneffe Atoll Sustainability Association (TASA)


**Date Generated:** `r format(Sys.time(), '%Y-%m-%d')` \
**Source Data:** `r params$datafile_name` \
**Generated by:** `r params$user_name`\
**App Version:** `r params$release`\

***