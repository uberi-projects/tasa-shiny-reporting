---
output:
  officedown::rdocx_document:
    reference_docx: report_template.docx
    tables:
      style: table_template
params:
  release: "Unknown"
  user_name: "Unknown"
  fisheries_multiper_timeframe: "Annual"
  datafile1: pressure
  datafile1_name: "Unknown"
  datafile2: pressure
  datafile2_name: "Unknown"
  datafile3: NULL
  datafile3_name: "Unknown"
  datafile4: NULL
  datafile4_name: "Unknown"
  fisheries_multiper1_year_selection: "None"
  fisheries_multiper1_period_selection: "None"
  fisheries_multiper1_lobster_season_selection: "None" 
  fisheries_multiper1_conch_season_selection: "None" 
  fisheries_multiper1_finfish_season_selection: "None"
  fisheries_multiper2_year_selection: "None"
  fisheries_multiper2_period_selection: "None"
  fisheries_multiper2_lobster_season_selection: "None" 
  fisheries_multiper2_conch_season_selection: "None" 
  fisheries_multiper2_finfish_season_selection: "None"
  fisheries_multiper3_year_selection: "None"
  fisheries_multiper3_period_selection: "None"
  fisheries_multiper3_lobster_season_selection: "None" 
  fisheries_multiper3_conch_season_selection: "None" 
  fisheries_multiper3_finfish_season_selection: "None"
  fisheries_multiper4_year_selection: "None"
  fisheries_multiper4_period_selection: "None"
  fisheries_multiper4_lobster_season_selection: "None" 
  fisheries_multiper4_conch_season_selection: "None" 
  fisheries_multiper4_finfish_season_selection: "None"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

# Load packages ---------------------------
library(knitr)
library(officedown)
library(rmarkdown)
library(tidyverse)
library(ggpubr)

# Source code  ---------------------------
source("theme.r")
source("map.r")

# Define datafiles ---------------------------
datafile_names <- c(params$datafile1_name, params$datafile2_name)
if (!is.null(params$datafile3)) {
  datafile_names <- c(datafile_names, params$datafile3_name)
}
if (!is.null(params$datafile4)) {
  datafile_names <- c(datafile_names, params$datafile4_name)
}
datafiles <- knitr::combine_words(datafile_names)

# Determine year or season  ---------------------------
timeframe <- params$fisheries_multiper_timeframe

# Filter to year or season  ---------------------------
df_1 <- params$datafile1[[1]]
df_1$`Date of Encounter` <- as.Date(df_1$`Date of Encounter`)
if (timeframe == "Annual" && as.character(params$fisheries_multiper1_year_selection) != "None") {
  df_1 <- df_1 |>
    filter(format(`Date of Encounter`, "%Y") == params$fisheries_multiper1_year_selection)
} else if (timeframe == "Seasonal" && as.character(params$fisheries_multiper1_lobster_season_selection) != "None") {
  season_years <- unlist(strsplit(params$fisheries_multiper1_lobster_season_selection, "-"))
  start_date <- as.Date(paste0(season_years[1], "-07-01"))
  end_date <- as.Date(paste0(season_years[2], "-02-28"))
  df_1 <- df_1 |>
    filter(`Date of Encounter` >= start_date, `Date of Encounter` <= end_date)
}
df_2 <- params$datafile2[[1]]
df_2$`Date of Encounter` <- as.Date(df_2$`Date of Encounter`)
if (timeframe == "Annual" && as.character(params$fisheries_multiper2_year_selection) != "None") {
  df_2 <- df_2 |>
    filter(format(`Date of Encounter`, "%Y") == params$fisheries_multiper2_year_selection)
} else if (timeframe == "Seasonal" && as.character(params$fisheries_multiper2_lobster_season_selection) != "None") {
  season_years <- unlist(strsplit(params$fisheries_multiper2_lobster_season_selection, "-"))
  start_date <- as.Date(paste0(season_years[1], "-07-01"))
  end_date <- as.Date(paste0(season_years[2], "-02-28"))
  df_2 <- df_2 |>
    filter(`Date of Encounter` >= start_date, `Date of Encounter` <= end_date)
}
if (!is.null(params$datafile3)) {
  df_3 <- params$datafile3[[1]]
  df_3$`Date of Encounter` <- as.Date(df_3$`Date of Encounter`)
  if (timeframe == "Annual" && as.character(params$fisheries_multiper3_year_selection) != "None") {
    df_3 <- df_3 |>
      filter(format(`Date of Encounter`, "%Y") == params$fisheries_multiper3_year_selection)
  } else if (timeframe == "Seasonal" && as.character(params$fisheries_multiper3_lobster_season_selection) != "None") {
    season_years <- unlist(strsplit(params$fisheries_multiper3_lobster_season_selection, "-"))
    start_date <- as.Date(paste0(season_years[1], "-07-01"))
    end_date <- as.Date(paste0(season_years[2], "-02-28"))
    df_3 <- df_3 |>
      filter(`Date of Encounter` >= start_date, `Date of Encounter` <= end_date)
  }
}
if (!is.null(params$datafile4)) {
  df_4 <- params$datafile4[[1]]
  df_4$`Date of Encounter` <- as.Date(df_4$`Date of Encounter`)
  if (timeframe == "Annual" && as.character(params$fisheries_multiper4_year_selection) != "None") {
    df_4 <- df_4 |>
      filter(format(`Date of Encounter`, "%Y") == params$fisheries_multiper4_year_selection)
  } else if (timeframe == "Seasonal" && as.character(params$fisheries_multiper4_lobster_season_selection) != "None") {
    season_years <- unlist(strsplit(params$fisheries_multiper4_lobster_season_selection, "-"))
    start_date <- as.Date(paste0(season_years[1], "-07-01"))
    end_date <- as.Date(paste0(season_years[2], "-02-28"))
    df_4 <- df_4 |>
      filter(`Date of Encounter` >= start_date, `Date of Encounter` <= end_date)
  }
}

# Add month column  ---------------------------
df_1$Month <- format(df_1$`Date of Encounter`, "%b %Y")
df_2$Month <- format(df_2$`Date of Encounter`, "%b %Y")
if (!is.null(params$datafile3)) {
  df_3$Month <- format(df_3$`Date of Encounter`, "%b %Y")
}
if (!is.null(params$datafile4)) {
  df_4$Month <- format(df_4$`Date of Encounter`, "%b %Y")
}

# Define individual study timeframes ---------------------------
study_start_1 <- min(df_1$`Date of Encounter`, na.rm = TRUE)
study_end_1 <- max(df_1$`Date of Encounter`, na.rm = TRUE)
study_start_2 <- min(df_2$`Date of Encounter`, na.rm = TRUE)
study_end_2 <- max(df_2$`Date of Encounter`, na.rm = TRUE)
if (!is.null(params$datafile3)) {
  study_start_3 <- min(df_3$`Date of Encounter`, na.rm = TRUE)
  study_end_3 <- max(df_3$`Date of Encounter`, na.rm = TRUE)
}
if (!is.null(params$datafile4)) {
  study_start_4 <- min(df_4$`Date of Encounter`, na.rm = TRUE)
  study_end_4 <- max(df_4$`Date of Encounter`, na.rm = TRUE)
}

# Assign Season if Relevant ---------------------------
if (timeframe == "Seasonal") {
  df_1 <- mutate(df_1, Season = paste0(format(study_start_1, "%Y"), "-", format(study_end_1, "%Y")))
  df_2 <- mutate(df_2, Season = paste0(format(study_start_2, "%Y"), "-", format(study_end_2, "%Y")))
  if (!is.null(params$datafile3)) {
    df_3 <- mutate(df_3, Season = paste0(format(study_start_3, "%Y"), "-", format(study_end_3, "%Y")))
  }
  if (!is.null(params$datafile4)) {
    df_4 <- mutate(df_4, Season = paste0(format(study_start_4, "%Y"), "-", format(study_end_4, "%Y")))
  }
}

# Merge dfs  ---------------------------
df <- df_1 %>%
  bind_rows(df_2)
if (!is.null(params$datafile3)) {
  df <- df %>%
    bind_rows(df_3)
}
if (!is.null(params$datafile4)) {
  df <- df %>%
    bind_rows(df_4)
}

# Define study timeframe ---------------------------
study_start <- min(df$`Date of Encounter`, na.rm = TRUE)
study_end <- max(df$`Date of Encounter`, na.rm = TRUE)
if (timeframe == "Annual") {
  study_timeframe <- combine_words(unique(format(df$`Date of Encounter`, "%Y")))
} else if (timeframe == "Seasonal") {
  study_timeframe <- c(paste0(format(study_start_1, "%Y"), "-", format(study_end_1, "%Y")), paste0(format(study_start_2, "%Y"), "-", format(study_end_2, "%Y")))
  if (!is.null(params$datafile3)) {
    study_timeframe <- c(study_timeframe, paste0(format(study_start_3, "%Y"), "-", format(study_end_3, "%Y")))
  }
  if (!is.null(params$datafile4)) {
    study_timeframe <- c(study_timeframe, paste0(format(study_start_4, "%Y"), "-", format(study_end_4, "%Y")))
  }
  study_timeframe <- combine_words(study_timeframe)
}
```

# Turneffe Atoll Fisheries Catch Lobster `r timeframe` Dataset Report: `r study_timeframe`


Turneffe Atoll Sustainability Association (TASA)


***

Coral reef ecosystems, like those of Turneffe Atoll Marine Reserve (TAMR), provide key ecological and economic value to coastal families. 
With proper management and monitoring, 
these ecosystems can continue to support people sustainably in the long-term. 
Directly tracking the activities and harvests of local fishers is a key method for monitoring coral reefs, 
as it offers insights into ecosystem dynamics and possible pressures. 
This report presents `r tolower(timeframe)` findings from fishery-dependent monitoring of Caribbean spiny 
lobster (*Panulirus argus*) at Turneffe Atoll Marine Reserve (TAMR) from `r study_timeframe`. 
Data were recorded by TASA patrolling officers in direct communication with TAMR fishers during their fishing trips. 
Data were collected on key economic species. 
This report aims to summarize and visualize the Fisheries 
Lobster Catch dataset from `r study_timeframe` to facilitate data interpretation and strengthen the scientific basis for 
management decisions by TASA staff, collaborators, and stakeholders.\


## Background

### Turneffe Atoll Marine Reserve

Turneffe Atoll is the largest atoll in Belize, spanning mangrove and littoral forest cayes, seagrass beds, and coral reef ecosystems (Stoddart, 1962). 
It features an inner lagoon as well as an outer reef that encircles the atoll. 
The Turneffe Atoll Marine Reserve (TAMR), which encompasses the entire atoll, covers 1,471 km² and includes multiple management zones, such as general use, conservation, preservation, and spawning aggregation zones, as well as special management areas. 
TAMR plays a valuable role in supporting biodiversity and sustaining the communities that depend on its resources. 
Its reef provides coastal protection from extreme weather events (Fedler, 2011), serves as a habitat for diverse marine species, and supports economic activities such as commercial and recreational fishing, guided diving, and tourism.\

### Fisheries Catch Project


### Caribbean Spiny Lobsters

Caribbean spiny lobsters (Panulirus argus) are brown-grey striped malacostracans, 
which can grow to around 60cm long, and have spines covering their shells instead of the 
large pinching claws of other lobsters (Holthuis, 1991). Spotted spiny lobster 
(Panulirus guttatus) are smaller than Caribbean spiny lobsters, with more distinct 
spots and shorter antennae. In Belize, the lobster fishery is the most important fishery 
in the country. Lobsters are caught using freediving and a hook stick, trapezoidal-shaped 
lobster traps placed in shallow sandy areas, or casitas (shade cloths) that act as a lure 
for lobsters which are then caught with a hook stick, snare, or a net bag (UNCTAD 2020). 
Regulations for Caribbean spiny lobster from the BFD include that no person shall fish 
molting lobster or lobster with eggs, that fished lobster have minimum carapace length 
of 3-inches and minimum tail weight of 4-ounces, and that fishers adhere to the prescribed 
open season. Closed season is March 1st to June 30th for lobster (Belize Fisheries 
Department accessed 2025). Tar spots on female lobsters indicate recent mating, and 
females with eggs (‘berried’ females) indicate reproductive success. Monitoring sex ratio 
and presence of reproductive indicators is key for this species.\


## Methods

This report, including text, figures, and tables, was generated using the 
Turneffe Reef-Monitoring Data Reporting Tool (TASA 2025, version `r params$release`), an R Shiny app which takes 
standardized reef monitoring data, validates the dataset, and creates a shareable output. \


## Results


```{r table1_prep, echo = FALSE, include = FALSE}
# Create annual df for Table 1 ---------------------------
if (timeframe == "Annual") {
  df_events_overall <- df %>%
    select(`Mission Id`, `Hours Fished`) %>%
    distinct() %>%
    mutate(`Hours Fished` = as.numeric(`Hours Fished`)) %>%
    filter(!is.na(`Hours Fished`), `Hours Fished` > 0) %>%
    summarize(
      Hours = sum(`Hours Fished`, na.rm = TRUE)
    ) %>%
    mutate(Year = "Overall")
  df_table1_overall <- df %>%
    summarize(
      Vessels = n_distinct(`Name of Vessel`),
      Lobster = n(),
      Missions = n_distinct(`Mission Id`)
    ) %>%
    mutate(Year = "Overall") %>%
    left_join(df_events_overall, by = "Year") %>%
    mutate(
      `CPUE (num/hr)` = ifelse(Hours > 0, round(Lobster / Hours, 1), NA)
    )
  df_events <- df %>%
    mutate(
      Year = format(df$`Date of Encounter`, "%Y")
    ) %>%
    select(Year, `Mission Id`, `Hours Fished`) %>%
    distinct() %>%
    mutate(`Hours Fished` = as.numeric(`Hours Fished`)) %>%
    filter(!is.na(`Hours Fished`), `Hours Fished` > 0) %>%
    group_by(Year) %>%
    summarize(
      Hours = sum(`Hours Fished`, na.rm = TRUE)
    )
  df_table1 <- df %>%
    mutate(
      Year = format(df$`Date of Encounter`, "%Y")
    ) %>%
    group_by(Year) %>%
    summarize(
      Vessels = n_distinct(`Name of Vessel`),
      Lobster = n(),
      Missions = n_distinct(`Mission Id`)
    ) %>%
    left_join(df_events, by = "Year") %>%
    mutate(
      `CPUE (num/hr)` = ifelse(Hours > 0, round(Lobster / Hours, 1), NA)
    ) %>%
    bind_rows(df_table1_overall)

  # Prepare dynamic variables for Table 1 ---------------------------
  total_vessels <- length(unique(df$`Name of Vessel`))
  total_lobsters <- df_table1_overall$Lobster
  total_events <- df_table1_overall$Missions
  total_hours <- df_table1_overall$Hours
  max_cpue_num <- max(df_table1$`CPUE (num/hr)`, na.rm = TRUE)
  max_cpue_num_period <- df_table1$Year[which.max(df_table1$`CPUE (num/hr)`)]
  min_cpue_num <- min(df_table1$`CPUE (num/hr)`, na.rm = TRUE)
  min_cpue_num_period <- df_table1$Year[which.min(df_table1$`CPUE (num/hr)`)]
}

# Create seasonal df for Table 1 ---------------------------
if (timeframe == "Seasonal") {
  df_events_overall <- df %>%
    select(`Mission Id`, `Hours Fished`) %>%
    distinct() %>%
    mutate(`Hours Fished` = as.numeric(`Hours Fished`)) %>%
    filter(!is.na(`Hours Fished`), `Hours Fished` > 0) %>%
    summarize(
      Hours = sum(`Hours Fished`, na.rm = TRUE)
    ) %>%
    mutate(Season = "Overall")
  df_table1_overall <- df %>%
    summarize(
      Vessels = n_distinct(`Name of Vessel`),
      Lobster = n(),
      Missions = n_distinct(`Mission Id`)
    ) %>%
    mutate(Season = "Overall") %>%
    left_join(df_events_overall, by = "Season") %>%
    mutate(
      `CPUE (num/hr)` = ifelse(Hours > 0, round(Lobster / Hours, 1), NA)
    )
  df_events <- df %>%
    select(Season, `Mission Id`, `Hours Fished`) %>%
    distinct() %>%
    mutate(`Hours Fished` = as.numeric(`Hours Fished`)) %>%
    filter(!is.na(`Hours Fished`), `Hours Fished` > 0) %>%
    group_by(Season) %>%
    summarize(
      Hours = sum(`Hours Fished`, na.rm = TRUE)
    )
  df_table1 <- df %>%
    group_by(Season) %>%
    summarize(
      Vessels = n_distinct(`Name of Vessel`),
      Lobster = n(),
      Missions = n_distinct(`Mission Id`)
    ) %>%
    left_join(df_events, by = "Season") %>%
    mutate(
      `CPUE (num/hr)` = ifelse(Hours > 0, round(Lobster / Hours, 1), NA)
    ) %>%
    bind_rows(df_table1_overall)

  # Prepare dynamic variables for Table 1 ---------------------------
  total_vessels <- length(unique(df$`Name of Vessel`))
  total_lobsters <- df_table1_overall$Lobster
  total_events <- df_table1_overall$Missions
  total_hours <- df_table1_overall$Hours
  max_cpue_num <- max(df_table1$`CPUE (num/hr)`, na.rm = TRUE)
  max_cpue_num_period <- df_table1$Season[which.max(df_table1$`CPUE (num/hr)`)]
  min_cpue_num <- min(df_table1$`CPUE (num/hr)`, na.rm = TRUE)
  min_cpue_num_period <- df_table1$Season[which.min(df_table1$`CPUE (num/hr)`)]
}
```


Between `r study_start` and `r study_end`, `r total_lobsters` Caribbean spiny lobsters were 
caught and recorded as part of the TAMR 
Fisheries Catch dataset. These lobsters were caught across `r total_events` missions, 
between `r total_vessels` surveyed vessels, 
totalling `r total_hours` active fishing hours.
The highest CPUE in count 
per hour (num/hr) occurred in `r max_cpue_num_period` 
with `r max_cpue_num`, whereas the lowest was `r min_cpue_num_period` 
in `r min_cpue_num` (Table 1; Figure 1).\

**Table 1.** Summary of fishing activity by period, including number of surveyed vessels, 
missions, and lobster caught, along with fishing hours, pounds of catch, 
and catch per unit effort (CPUE). 
CPUE values are calculated only for missions where fishing hours and catch weight were recorded. 
Data were collected using Fisheries catch lobster data from Turneffe Atoll Marine Reserve, `r study_timeframe`.\


```{r table1, echo = FALSE}
# show table
as.data.frame(df_table1)
```


<br>


```{r table1_expanded, echo = FALSE, include = FALSE}
# Create annual df for Table 1 expanded details ---------------------------
if (timeframe == "Annual") {
  df_table1expanded_rows <- df %>%
    mutate(
      Year = format(df$`Date of Encounter`, "%Y")
    ) %>%
    group_by(`Mission Id`) %>%
    mutate(`Hours Fished` = as.numeric(`Hours Fished`)) %>%
    summarize(
      Year = first(Year),
      Hours = first(`Hours Fished`),
      Lobster = n(),
      .groups = "drop"
    ) %>%
    mutate(
      `CPUE (num/hr)` = ifelse(Hours > 0, Lobster / Hours, NA)
    )
  df_table1expanded_num_overall <- df_table1expanded_rows %>%
    summarize(
      Min = round(min(`CPUE (num/hr)`, na.rm = TRUE), 1),
      Mean = round(mean(`CPUE (num/hr)`, na.rm = TRUE), 1),
      Median = round(median(`CPUE (num/hr)`, na.rm = TRUE), 1),
      Max = round(max(`CPUE (num/hr)`, na.rm = TRUE), 1),
      SD = round(sd(`CPUE (num/hr)`, na.rm = TRUE), 1)
    ) %>%
    mutate(Year = "Overall", CPUE = "num/hr")
  df_table1expanded <- df_table1expanded_rows %>%
    mutate(CPUE = "num/hr") %>%
    group_by(CPUE, Year) %>%
    summarize(
      Min = round(min(`CPUE (num/hr)`, na.rm = TRUE), 1),
      Mean = round(mean(`CPUE (num/hr)`, na.rm = TRUE), 1),
      Median = round(median(`CPUE (num/hr)`, na.rm = TRUE), 1),
      Max = round(max(`CPUE (num/hr)`, na.rm = TRUE), 1),
      SD = round(sd(`CPUE (num/hr)`, na.rm = TRUE), 1),
      .groups = "drop"
    ) %>%
    bind_rows(df_table1expanded_num_overall)

  # Prepare dynamic variables for Table 1 Expanded ---------------------------
  overall_mean <- df_table1expanded_num_overall$Mean
  overall_median <- df_table1expanded_num_overall$Median
  overall_min <- df_table1expanded_num_overall$Min
  overall_max <- df_table1expanded_num_overall$Max
  overall_sd <- df_table1expanded_num_overall$SD
  max_cpue_mean_num <- max(df_table1expanded$Mean, na.rm = TRUE)
  max_cpue_mean_num_period <- df_table1expanded$Year[which.max(df_table1expanded$Mean)]
  min_cpue_mean_num <- min(df_table1expanded$Mean, na.rm = TRUE)
  min_cpue_mean_num_period <- df_table1expanded$Year[which.min(df_table1expanded$Mean)]
}

# Create seasonal df for Table 1 expanded details ---------------------------
if (timeframe == "Seasonal") {
  df_table1expanded_rows <- df %>%
    group_by(`Mission Id`) %>%
    mutate(`Hours Fished` = as.numeric(`Hours Fished`)) %>%
    summarize(
      Season = first(Season),
      Hours = first(`Hours Fished`),
      Lobster = n(),
      .groups = "drop"
    ) %>%
    mutate(
      `CPUE (num/hr)` = ifelse(Hours > 0, Lobster / Hours, NA)
    )
  df_table1expanded_num_overall <- df_table1expanded_rows %>%
    summarize(
      Min = round(min(`CPUE (num/hr)`, na.rm = TRUE), 1),
      Mean = round(mean(`CPUE (num/hr)`, na.rm = TRUE), 1),
      Median = round(median(`CPUE (num/hr)`, na.rm = TRUE), 1),
      Max = round(max(`CPUE (num/hr)`, na.rm = TRUE), 1),
      SD = round(sd(`CPUE (num/hr)`, na.rm = TRUE), 1)
    ) %>%
    mutate(Season = "Overall", CPUE = "num/hr")
  df_table1expanded <- df_table1expanded_rows %>%
    mutate(CPUE = "num/hr") %>%
    group_by(CPUE, Season) %>%
    summarize(
      Min = round(min(`CPUE (num/hr)`, na.rm = TRUE), 1),
      Mean = round(mean(`CPUE (num/hr)`, na.rm = TRUE), 1),
      Median = round(median(`CPUE (num/hr)`, na.rm = TRUE), 1),
      Max = round(max(`CPUE (num/hr)`, na.rm = TRUE), 1),
      SD = round(sd(`CPUE (num/hr)`, na.rm = TRUE), 1),
      .groups = "drop"
    ) %>%
    bind_rows(df_table1expanded_num_overall)

  # Prepare dynamic variables for Table 1 Expanded ---------------------------
  overall_mean <- df_table1expanded_num_overall$Mean
  overall_median <- df_table1expanded_num_overall$Median
  overall_min <- df_table1expanded_num_overall$Min
  overall_max <- df_table1expanded_num_overall$Max
  overall_sd <- df_table1expanded_num_overall$SD
  max_cpue_mean_num <- max(df_table1expanded$Mean, na.rm = TRUE)
  max_cpue_mean_num_period <- df_table1expanded$Season[which.max(df_table1expanded$Mean)]
  min_cpue_mean_num <- min(df_table1expanded$Mean, na.rm = TRUE)
  min_cpue_mean_num_period <- df_table1expanded$Season[which.min(df_table1expanded$Mean)]
}
```


The CPUE of lobster in count per hour had a 
mean of `r overall_mean`num/hr and median of `r overall_median`num/hr, 
with the highest mean of `r max_cpue_mean_num`num/hr being in `r max_cpue_mean_num_period` 
and the lowest mean of `r min_cpue_mean_num`num/hr being in `r min_cpue_mean_num_period`. 
Minimum CPUE recorded across all missions was `r overall_min`num/hr, maximum was `r overall_max`num/hr, 
and standard deviation was `r overall_sd`num/hr 
(Table 1; Figure 1).\


```{r figure1_prep, echo = FALSE, include = FALSE}
# Create annual Figure 1 ---------------------------
if (timeframe == "Annual") {
  df_fig1_A <- df %>%
    mutate(
      Year = format(df$`Date of Encounter`, "%Y")
    ) %>%
    group_by(Year) %>%
    summarize(
      Vessels = n_distinct(`Name of Vessel`),
      Lobster = n(),
      Missions = n_distinct(`Mission Id`)
    ) %>%
    left_join(df_events, by = "Year") %>%
    mutate(
      `CPUE (num/hr)` = round(Lobster / Hours, 1)
    )
  A <- ggplot(df_fig1_A, aes(x = Year, y = Hours, group = 1)) +
    geom_line(size = 0.5) +
    geom_point(size = 2.5) +
    expand_limits(y = 0) +
    theme_custom +
    xlab("Year") +
    ylab("Hours Fished") +
    labs(title = "A")
  B <- ggplot(df_fig1_A, aes(x = Year, y = Lobster, group = 1)) +
    geom_line(size = 0.5) +
    geom_point(size = 2.5) +
    expand_limits(y = 0) +
    theme_custom +
    xlab("Year") +
    ylab("Number Lobsters") +
    labs(title = "B")
  C <- ggplot(df_fig1_A, aes(x = Year, y = `CPUE (num/hr)`, group = 1)) +
    geom_line(size = 0.5) +
    geom_point(size = 2.5) +
    expand_limits(y = 0) +
    theme_custom +
    xlab("Year") +
    ylab("Catch per Unit Effort") +
    labs(title = "C")
}

# Create seasonal Figure 1 ---------------------------
if (timeframe == "Seasonal") {
  df_fig1_A <- df %>%
    group_by(Season) %>%
    summarize(
      Vessels = n_distinct(`Name of Vessel`),
      Lobster = n(),
      Missions = n_distinct(`Mission Id`)
    ) %>%
    left_join(df_events, by = "Season") %>%
    mutate(
      `CPUE (num/hr)` = round(Lobster / Hours, 1)
    )
  A <- ggplot(df_fig1_A, aes(x = Season, y = Hours, group = 1)) +
    geom_line(size = 0.5) +
    geom_point(size = 2.5) +
    expand_limits(y = 0) +
    theme_custom +
    xlab("Season") +
    ylab("Hours Fished") +
    labs(title = "A")
  B <- ggplot(df_fig1_A, aes(x = Season, y = Lobster, group = 1)) +
    geom_line(size = 0.5) +
    geom_point(size = 2.5) +
    expand_limits(y = 0) +
    theme_custom +
    xlab("Season") +
    ylab("Number Lobsters") +
    labs(title = "B")
  C <- ggplot(df_fig1_A, aes(x = Season, y = `CPUE (num/hr)`, group = 1)) +
    geom_line(size = 0.5) +
    geom_point(size = 2.5) +
    expand_limits(y = 0) +
    theme_custom +
    xlab("Season") +
    ylab("Catch per Unit Effort") +
    labs(title = "C")
}

# Assemble Figure 1 ---------------------------
figure1 <- ggarrange(
  A, B, C,
  nrow = 3, ncol = 1
)
```


```{r figure1, fig.width=6, fig.height=8, fig.align = 'left', echo = FALSE}
figure1
```


*Figure 1.* Line plots of 
active hours fished (A), lobsters caught (B), 
and catch per unit effort (in count per active hour fished) (C) 
over time. 
Data were collected using Fisheries catch lobster data from Turneffe Atoll Marine Reserve, `r study_timeframe`.\


```{r table2_prep, echo = FALSE, include = FALSE}
# Create annual df for Table 2 ---------------------------
if (timeframe == "Annual") {
  df_table2 <- df %>%
    mutate(
      Year = format(df$`Date of Encounter`, "%Y"),
      weight_for_headed = ifelse(`Weight Type` == "headed", `Total Weight (g)`, NA_real_)
    ) %>%
    mutate(
      `Carapace Length (mm)` = as.numeric(`Carapace Length (mm)`),
      weight_for_headed = as.numeric(weight_for_headed)
    ) %>%
    group_by(Year) %>%
    summarize(
      `Mean Carapace Length (mm)` = round(mean(`Carapace Length (mm)`, na.rm = TRUE), 1),
      `Median Carapace Length (mm)` = round(median(`Carapace Length (mm)`, na.rm = TRUE), 1),
      `Mean Weight (g)` = round(mean(weight_for_headed, na.rm = TRUE), 1),
      `Median Weight (g)` = round(median(weight_for_headed, na.rm = TRUE), 1),
      `Female (%)` = round(100 * sum(Sex == "Female", na.rm = TRUE) / n(), 1),
      `Male (%)` = round(100 * sum(Sex == "Male", na.rm = TRUE) / n(), 1)
    ) %>%
    bind_rows(
      df %>%
        mutate(
          weight_for_headed = ifelse(`Weight Type` == "headed", `Total Weight (g)`, NA_real_)
        ) %>%
        mutate(
          `Carapace Length (mm)` = as.numeric(`Carapace Length (mm)`),
          weight_for_headed = as.numeric(weight_for_headed)
        ) %>%
        summarize(
          `Mean Carapace Length (mm)` = round(mean(`Carapace Length (mm)`, na.rm = TRUE), 1),
          `Median Carapace Length (mm)` = round(median(`Carapace Length (mm)`, na.rm = TRUE), 1),
          `Mean Weight (g)` = round(mean(weight_for_headed, na.rm = TRUE), 1),
          `Median Weight (g)` = round(median(weight_for_headed, na.rm = TRUE), 1),
          `Female (%)` = round(100 * sum(Sex == "Female", na.rm = TRUE) / n(), 1),
          `Male (%)` = round(100 * sum(Sex == "Male", na.rm = TRUE) / n(), 1)
        ) %>%
        mutate(Year = "Overall")
    ) %>%
    mutate(across(everything(), ~ {
      if (is.numeric(.)) {
        ifelse(is.na(.) | is.nan(.), "-", as.character(.))
      } else {
        ifelse(is.na(.), "-", .)
      }
    }))
  total_male <- filter(df_table2, Year == "Overall")$`Male (%)`
  total_female <- filter(df_table2, Year == "Overall")$`Female (%)`
  total_carapace <- filter(df_table2, Year == "Overall")$`Mean Carapace Length (mm)`
  total_weight <- filter(df_table2, Year == "Overall")$`Mean Weight (g)`
  max_carapace <- max(filter(df_table2, Year != "Overall")$`Mean Carapace Length (mm)`, na.rm = TRUE)
  max_carapace_period <- df_table2$Year[which.max(filter(df_table2, Year != "Overall")$`Mean Carapace Length (mm)`)]
  max_weight <- max(filter(df_table2, Year != "Overall")$`Mean Weight (g)`, na.rm = TRUE)
  max_weight_period <- df_table2$Year[which.max(filter(df_table2, Year != "Overall")$`Mean Weight (g)`)]
  max_female <- max(filter(df_table2, Year != "Overall")$`Female (%)`, na.rm = TRUE)
  max_female_period <- df_table2$Year[which.max(filter(df_table2, Year != "Overall")$`Female (%)`)]
  max_male <- max(filter(df_table2, Year != "Overall")$`Male (%)`, na.rm = TRUE)
  max_male_period <- df_table2$Year[which.max(filter(df_table2, Year != "Overall")$`Male (%)`)]
}

# Create seasonal df for Table 2 ---------------------------
if (timeframe == "Seasonal") {
  df_table2 <- df %>%
    mutate(
      weight_for_headed = ifelse(`Weight Type` == "headed", `Total Weight (g)`, NA_real_)
    ) %>%
    mutate(
      `Carapace Length (mm)` = as.numeric(`Carapace Length (mm)`),
      weight_for_headed = as.numeric(weight_for_headed)
    ) %>%
    group_by(Season) %>%
    summarize(
      `Mean Carapace Length (mm)` = round(mean(`Carapace Length (mm)`, na.rm = TRUE), 1),
      `Median Carapace Length (mm)` = round(median(`Carapace Length (mm)`, na.rm = TRUE), 1),
      `Mean Weight (g)` = round(mean(weight_for_headed, na.rm = TRUE), 1),
      `Median Weight (g)` = round(median(weight_for_headed, na.rm = TRUE), 1),
      `Female (%)` = round(100 * sum(Sex == "Female", na.rm = TRUE) / n(), 1),
      `Male (%)` = round(100 * sum(Sex == "Male", na.rm = TRUE) / n(), 1)
    ) %>%
    bind_rows(
      df %>%
        mutate(
          weight_for_headed = ifelse(`Weight Type` == "headed", `Total Weight (g)`, NA_real_)
        ) %>%
        mutate(
          `Carapace Length (mm)` = as.numeric(`Carapace Length (mm)`),
          weight_for_headed = as.numeric(weight_for_headed)
        ) %>%
        summarize(
          `Mean Carapace Length (mm)` = round(mean(`Carapace Length (mm)`, na.rm = TRUE), 1),
          `Median Carapace Length (mm)` = round(median(`Carapace Length (mm)`, na.rm = TRUE), 1),
          `Mean Weight (g)` = round(mean(weight_for_headed, na.rm = TRUE), 1),
          `Median Weight (g)` = round(median(weight_for_headed, na.rm = TRUE), 1),
          `Female (%)` = round(100 * sum(Sex == "Female", na.rm = TRUE) / n(), 1),
          `Male (%)` = round(100 * sum(Sex == "Male", na.rm = TRUE) / n(), 1)
        ) %>%
        mutate(Season = "Overall")
    ) %>%
    mutate(across(everything(), ~ {
      if (is.numeric(.)) {
        ifelse(is.na(.) | is.nan(.), "-", as.character(.))
      } else {
        ifelse(is.na(.), "-", .)
      }
    }))
  total_male <- filter(df_table2, Season == "Overall")$`Male (%)`
  total_female <- filter(df_table2, Season == "Overall")$`Female (%)`
  total_carapace <- filter(df_table2, Season == "Overall")$`Mean Carapace Length (mm)`
  total_weight <- filter(df_table2, Season == "Overall")$`Mean Weight (g)`
  max_carapace <- max(filter(df_table2, Season != "Overall")$`Mean Carapace Length (mm)`, na.rm = TRUE)
  max_carapace_period <- df_table2$Season[which.max(filter(df_table2, Season != "Overall")$`Mean Carapace Length (mm)`)]
  max_weight <- max(filter(df_table2, Season != "Overall")$`Mean Weight (g)`, na.rm = TRUE)
  max_weight_period <- df_table2$Season[which.max(filter(df_table2, Season != "Overall")$`Mean Weight (g)`)]
  max_female <- max(filter(df_table2, Season != "Overall")$`Female (%)`, na.rm = TRUE)
  max_female_period <- df_table2$Season[which.max(filter(df_table2, Season != "Overall")$`Female (%)`)]
  max_male <- max(filter(df_table2, Season != "Overall")$`Male (%)`, na.rm = TRUE)
  max_male_period <- df_table2$Season[which.max(filter(df_table2, Season != "Overall")$`Male (%)`)]
}
```


Average carapace length was `r total_carapace`in, greatest in `r max_carapace_period` with `r max_carapace`in. 
Average headed weight was `r total_weight`g, greatest in `r max_weight_period` with `r max_weight`g. 
Overall, there was `r total_female`% female and `r total_male`% male lobsters identified, 
with the highest percent female of `r max_female` found in `r max_female_period`, 
and the highest percent male of `r max_male` found in `r max_male_period` (Table 2; Figure 2; Figure 3).\


**Table 2.** Summary of mean and median carapace length (mm) and headed weight (g), 
as well as percent of lobsters identified as male and female. 
Data were collected using Fisheries catch lobster data from Turneffe Atoll Marine Reserve, `r study_timeframe`.\


```{r table2, echo = FALSE}
# show table
as.data.frame(df_table2)
```



```{r figure2_prep, echo = FALSE, include = FALSE}
# Create annual Figure 2 ---------------------------
if (timeframe == "Annual") {
  df_fig2_unsummarized <- df %>%
    mutate(Year = format(df$`Date of Encounter`, "%Y")) %>%
    filter(!is.na(Sex)) %>%
    mutate(
      weight_for_headed = ifelse(`Weight Type` == "headed", `Total Weight (g)`, NA_real_),
      `Pleopod Stage` = as.character(`Pleopod Stage`),
      `Carapace Length (mm)` = as.numeric(`Carapace Length (mm)`),
      weight_for_headed = as.numeric(weight_for_headed)
    )
  df_fig2 <- df %>%
    mutate(Year = format(df$`Date of Encounter`, "%Y")) %>%
    filter(!is.na(Sex)) %>%
    mutate(
      weight_for_headed = ifelse(`Weight Type` == "headed", `Total Weight (g)`, NA_real_),
      `Pleopod Stage` = as.character(`Pleopod Stage`),
      `Carapace Length (mm)` = as.numeric(`Carapace Length (mm)`),
      weight_for_headed = as.numeric(weight_for_headed)
    ) %>%
    group_by(Year) %>%
    summarize(
      `Mean Carapace Length (mm)` = round(mean(`Carapace Length (mm)`, na.rm = TRUE), 1),
      `Mean Weight (g)` = round(mean(weight_for_headed, na.rm = TRUE), 1)
    )
  df_fig2_carapace <- df_fig2 %>%
    filter(!is.nan(`Mean Carapace Length (mm)`))
  df_fig2_weight <- df_fig2 %>%
    filter(!is.nan(`Mean Weight (g)`))
  A <- ggplot(df_fig2_unsummarized, aes(x = `Carapace Length (mm)`, fill = `Sex`)) +
    geom_histogram(binwidth = 10, color = "black") +
    scale_fill_manual(values = palette[2:3], drop = FALSE) +
    theme_custom +
    expand_limits(x = 0) +
    xlab("Carapace Length (mm)") +
    ylab("Count") +
    labs(title = "A")
  B <- ggplot(df_fig2_unsummarized, aes(x = weight_for_headed, fill = `Sex`)) +
    geom_histogram(binwidth = 50, color = "black") +
    scale_fill_manual(values = palette[2:3], drop = FALSE) +
    theme_custom +
    expand_limits(x = 0) +
    xlab("Weight (g)") +
    ylab("Count") +
    labs(title = "B")
  C <- ggplot(df_fig2_carapace, aes(x = Year, y = `Mean Carapace Length (mm)`)) +
    geom_line(size = 0.5) +
    geom_point(size = 2.5) +
    theme_custom +
    ylab("Mean Carapace Length (mm)") +
    xlab("Year") +
    scale_y_continuous(n.breaks = 4) +
    labs(title = "C") +
    theme(legend.position = "none")
  D <- ggplot(df_fig2_weight, aes(x = Year, y = `Mean Weight (g)`)) +
    geom_line(size = 0.5) +
    geom_point(size = 2.5) +
    theme_custom +
    ylab("Weight (g)") +
    xlab("Year") +
    labs(title = "D") +
    theme(legend.position = "none")
}

# Create seasonal Figure 2 ---------------------------
if (timeframe == "Seasonal") {
  df_fig2_unsummarized <- df %>%
    filter(!is.na(Sex)) %>%
    mutate(
      weight_for_headed = ifelse(`Weight Type` == "headed", `Total Weight (g)`, NA_real_),
      `Pleopod Stage` = as.character(`Pleopod Stage`),
      `Carapace Length (mm)` = as.numeric(`Carapace Length (mm)`),
      weight_for_headed = as.numeric(weight_for_headed)
    )
  df_fig2 <- df %>%
    filter(!is.na(Sex)) %>%
    mutate(
      weight_for_headed = ifelse(`Weight Type` == "headed", `Total Weight (g)`, NA_real_),
      `Pleopod Stage` = as.character(`Pleopod Stage`),
      `Carapace Length (mm)` = as.numeric(`Carapace Length (mm)`),
      weight_for_headed = as.numeric(weight_for_headed)
    ) %>%
    group_by(Season) %>%
    summarize(
      `Mean Carapace Length (mm)` = round(mean(`Carapace Length (mm)`, na.rm = TRUE), 1),
      `Median Carapace Length (mm)` = round(median(`Carapace Length (mm)`, na.rm = TRUE), 1),
      `Mean Weight (g)` = round(mean(weight_for_headed, na.rm = TRUE), 1),
      `Median Weight (g)` = round(median(weight_for_headed, na.rm = TRUE), 1),
      `Female (%)` = round(100 * sum(Sex == "Female", na.rm = TRUE) / n(), 1),
      `Male (%)` = round(100 * sum(Sex == "Male", na.rm = TRUE) / n(), 1)
    )
  df_fig2_carapace <- df_fig2 %>%
    filter(!is.nan(`Mean Carapace Length (mm)`))
  df_fig2_weight <- df_fig2 %>%
    filter(!is.nan(`Mean Weight (g)`))
  A <- ggplot(df_fig2_unsummarized, aes(x = `Carapace Length (mm)`, fill = `Sex`)) +
    geom_histogram(binwidth = 10, color = "black") +
    scale_fill_manual(values = palette[2:3], drop = FALSE) +
    theme_custom +
    expand_limits(x = 0) +
    xlab("Carapace Length (mm)") +
    ylab("Count") +
    labs(title = "A")
  B <- ggplot(df_fig2_unsummarized, aes(x = weight_for_headed, fill = `Sex`)) +
    geom_histogram(binwidth = 50, color = "black") +
    scale_fill_manual(values = palette[2:3], drop = FALSE) +
    theme_custom +
    expand_limits(x = 0) +
    xlab("Weight (g)") +
    ylab("Count") +
    labs(title = "B")
  C <- ggplot(df_fig2_carapace, aes(x = Season, y = `Mean Carapace Length (mm)`)) +
    geom_line(size = 0.5) +
    geom_point(size = 2.5) +
    theme_custom +
    ylab("Mean Carapace Length (mm)") +
    xlab("Season") +
    scale_y_continuous(n.breaks = 4) +
    labs(title = "C") +
    theme(legend.position = "none")
  D <- ggplot(df_fig2_weight, aes(x = Season, y = `Mean Weight (g)`)) +
    geom_line(size = 0.5) +
    geom_point(size = 2.5) +
    theme_custom +
    ylab("Weight (g)") +
    xlab("Season") +
    labs(title = "D") +
    theme(legend.position = "none")
}

# Assemble Figure 2 ---------------------------
figure_3_top <- ggarrange(
  A, B,
  ncol = 2, nrow = 1
)
figure2 <- ggarrange(
  figure_3_top, C, D,
  ncol = 1, nrow = 3
)
```


```{r figure2, fig.width=6, fig.height=8, fig.align = 'left', echo = FALSE}
figure2
```


*Figure 2.* Histogram of carapace length (mm) by sex (A), histogram of headed weight (g) by sex (B), 
line plot of mean carapace length (mm) over time (C), and line plot of headed mean weight (g) over time (D).
Data were collected using Fisheries catch lobster data from Turneffe Atoll Marine Reserve, `r study_timeframe`.\


```{r figure3_prep, echo = FALSE, include = FALSE}
# Create annual Figure 3 ---------------------------
if (timeframe == "Annual") {
  df_fig3 <- df %>%
    mutate(
      Year = format(df$`Date of Encounter`, "%Y")
    ) %>%
    group_by(Year) %>%
    summarize(
      Female = round(100 * sum(Sex == "Female", na.rm = TRUE) / n(), 1),
      Male = round(100 * sum(Sex == "Male", na.rm = TRUE) / n(), 1)
    ) %>%
    pivot_longer(cols = c(Female, Male), names_to = "Sex", values_to = "Percent")

  # Create Figure 3 ---------------------------
  A <- ggplot(df_fig3, aes(x = Year, fill = Sex, y = Percent)) +
    geom_col(color = "black") +
    scale_fill_manual(values = palette[2:3]) +
    theme_custom +
    xlab("Year") +
    ylab("Percent")
  B <- ggplot(filter(df_fig2_unsummarized, !is.na(`Pleopod Stage`)), aes(x = `Pleopod Stage`)) +
    geom_bar(color = "black", fill = palette[2]) +
    theme_custom +
    expand_limits(x = 0) +
    xlab("Pleopod Stage") +
    ylab("Count") +
    labs(title = "B")
  figure3 <- ggarrange(A, B, nrow = 1, ncol = 2)
}

# Create seasonal Figure 3 ---------------------------
if (timeframe == "Seasonal") {
  df_fig3 <- df %>%
    group_by(Season) %>%
    summarize(
      Female = round(100 * sum(Sex == "Female", na.rm = TRUE) / n(), 1),
      Male = round(100 * sum(Sex == "Male", na.rm = TRUE) / n(), 1)
    ) %>%
    pivot_longer(cols = c(Female, Male), names_to = "Sex", values_to = "Percent")

  # Create Figure 3 ---------------------------
  A <- ggplot(df_fig3, aes(x = Season, fill = Sex, y = Percent)) +
    geom_col(color = "black") +
    scale_fill_manual(values = palette[2:3]) +
    theme_custom +
    xlab("Season") +
    ylab("Percent")
  B <- ggplot(filter(df_fig2_unsummarized, !is.na(`Pleopod Stage`)), aes(x = `Pleopod Stage`)) +
    geom_bar(color = "black", fill = palette[2]) +
    theme_custom +
    expand_limits(x = 0) +
    xlab("Pleopod Stage") +
    ylab("Count") +
    labs(title = "B")
  figure3 <- ggarrange(A, B, nrow = 1, ncol = 2)
}
```


```{r figure3, fig.width=6, fig.height=2.5, fig.align = 'left', echo = FALSE}
figure3
```


*Figure 3.* Bar plot of sex ratio of lobsters over time (A) and bar plot of female pleopod stage (B). 
Data were collected using Fisheries catch lobster data from Turneffe Atoll Marine Reserve, `r study_timeframe`.\


<br>


## Conclusion

By summarizing and visualizing the fisheries catch lobster data from `r study_timeframe`, 
researchers, policy-makers, and other stakeholders are better able to interpret and use the dataset. 
This report supports the aims of the Fisheries Catch data collection by offering a more understandable view 
of the data itself, supporting future efforts to create recommendations on enforcement, monitoring, 
education, outreach, and regulations to ensure the long-term sustainability of the TAMR fishery while safeguarding the 
ecological value of the atoll.\


## Acknowledgments

Thank you to the data collectors and fishers who contributed to this project.\


## Report Metadata

**Date Generated:** `r format(Sys.time(), '%Y-%m-%d')` \
**Source Data:** `r datafiles` \
**Generated by:** `r params$user_name`\
**App Version:** `r params$release`\


## Literature Cited

Belize Fisheries Department. (n.d.-b). Fisheries Regulations. https://fisheries.gov.bz/regulations/

Fedler, A. J. (2011). The Economic Value of Turneffe Atoll (Full Report). Turneffe Atoll Trust. http://www.turneffeatollmarinereserve.org/app/webroot/userfiles/214/File/Turneffe%20Atoll%20Valuation%20Study%20PDF%20-%20Final%20Report.pdf

Holthuis, L. B. (Ed.). (1991). FAO species catalogue. 13: Marine lobsters of the world: an annotated and illustrated catalogueof species of interest to fisheries known to date / prep. by L. B. Holthuis

Meerman, J. C. (2013). Belize Basemap [Dataset]. Biodiversity and Environmental Resource Data System of Belize. http://www.biodiversity.bz/

Meerman, J. C. (2017). Belize_Ecosystems_2017 [Dataset]. Biodiversity and Environmental Resource Data System of Belize. http://www.biodiversity.bz/

Stoddart, D. R. (1962). Three Caribbean atolls: Turneffe Islands, Lighthouse Reef and Glover’s Reef,  British Honduras. Atoll Research Bulletin, 87, 1–151.

Turneffe Atoll Sustainability Association. (2025). Turneffe Reef-Monitoring Data Reporting Tool (Version 1.0) [Computer software].

United Nations Conference (UNCTAD) & on Trade and Development. (2020). Oceans Economy and Trade Strategy: Belize Marine Fisheries and Seafood Processing (UNCTAD/DITC/TED/INF/2020/5). https://unctad.org/system/files/official-document/ditctedinf2020d5_en.pdf
