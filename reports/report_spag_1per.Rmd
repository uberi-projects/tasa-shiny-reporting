---
output:
  officedown::rdocx_document:
    reference_docx: report_template.docx
    tables:
      style: table_template
params:
  release: "Unknown"
  user_name: "Unknown"
  datafile: pressure
  datafile_name: "Unknown"
  spag_1per_spag_season_selection: "None"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

# Load packages ---------------------------
library(knitr)
library(officedown)
library(rmarkdown)
library(tidyverse)
library(ggpubr)

# Source code  ---------------------------
source("theme.r")
source("map.r")

# Filter to season
df <- params$datafile[[1]]
df$Date <- as.Date(df$Date)
if (as.character(params$spag_1per_spag_season_selection) != "None") {
  season_years <- unlist(strsplit(params$spag_1per_spag_season_selection, "-"))
  start_date <- as.Date(paste0(season_years[1], "-12-01"))
  end_date <- as.Date(paste0(season_years[2], "-05-31"))
  df <- df |>
    filter(Date >= start_date, Date <= end_date)
}
# Add month column  ---------------------------
df$Month <- format(df$Date, "%b %Y")

# Define study timeframe ---------------------------
study_start <- min(df$Date, na.rm = TRUE)
study_end <- max(df$Date, na.rm = TRUE)
study_timeframe <- paste0(format(study_start, "%Y"), "-", format(study_end, "%Y"))
```

# Turneffe Atoll Spawning Aggregations Dataset Report: `r study_timeframe`


Turneffe Atoll Sustainability Association (TASA)


**Date Generated:** `r format(Sys.time(), '%Y-%m-%d')` \
**Source Data:** `r params$datafile_name` \
**Generated by:** `r params$user_name`\
**App Version:** `r params$release`\

***

SUMMARY GOES HERE

## Background

### Turneffe Atoll Marine Reserve

Turneffe Atoll is the largest atoll in Belize, spanning mangrove and littoral forest cayes, seagrass beds, and coral reef ecosystems (Stoddart, 1962). 
It features an inner lagoon as well as an outer reef that encircles the atoll. 
The Turneffe Atoll Marine Reserve (TAMR), which encompasses the entire atoll, covers 1,471 km² and includes multiple management zones, such as general use, conservation, preservation, and spawning aggregation zones, as well as special management areas. 
TAMR plays a valuable role in supporting biodiversity and sustaining the communities that depend on its resources. 
Its reef provides coastal protection from extreme weather events (Fedler, 2011), serves as a habitat for diverse marine species, and supports economic activities such as commercial and recreational fishing, guided diving, and tourism.\

### Spawning Aggregations Monitoring

INFO HERE


## Methods

SPAGs data were collected at Turneffe Atoll 
Marine Reserve (TAMR) (Figure 1). 
The survey period for this report’s dataset extended 
from `r study_start` to `r study_end` at TAMR.

INFO HERE


This report, including text, figures, and tables, was generated using the 
Turneffe Reef-Monitoring Data Reporting Tool (TASA 2025, version `r params$release`), an R Shiny app which takes 
standardized reef monitoring data, validates the dataset, and creates a shareable output. \

```{r figure1, echo = FALSE, fig.width = 7, fig.height = 7}
# Create map for Figure 1 ---------------------------
df_map <- df |>
  select(Site, Latitude, Longitude) |>
  distinct() |>
  na.omit()
if (study_year >= 2024) {
generate_map(df_map, "Latitude", "Longitude", "Site")
} else{
  generate_map_historic(df_map, "Latitude", "Longitude", "Site")
}
```


*Figure 1.* Map of Turneffe Atoll Marine Reserve zones and ecosystems. 
Shapefiles for zones belong to the Belize Fisheries Department (Belize Geomatics 2022). 
Shapefiles for the base map and ecosystems come from the publicly available Spatial Data 
Warehouse for Belize (Meerman 2013, Meerman 2017).
Waypoints for SPAG dives recorded in `r study_timeframe` are labelled on the map.\

 
## Results


## Conclusion

CONCLUSION


## Acknowledgments



## Literature Cited
